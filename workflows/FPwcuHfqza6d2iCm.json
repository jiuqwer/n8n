{
  "id": "FPwcuHfqza6d2iCm",
  "name": "è¶³çƒé¢„æµ‹-æ‰§è¡Œå‘˜",
  "nodes": [
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1600,
        504
      ],
      "id": "cebd76c7-5b3b-4891-a995-2651eeddd1ff",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "jsCode": "// 1. ä» Loop èŠ‚ç‚¹è·å–åŸºç¡€æ¯”èµ›ä¿¡æ¯\nconst matchInfo = $('PostgreSQL(Fetch)').item.json; \nconst homeTeam = matchInfo[\"home_team\"]; // æ³¨æ„ï¼šå­—æ®µåéœ€å¯¹åº”æ•°æ®åº“ä¸‹åˆ’çº¿æ ¼å¼\nconst awayTeam = matchInfo[\"away_team\"];\nconst league = matchInfo[\"league_name\"];\nconst matchTime = matchInfo[\"match_time\"];\n\nlet externalAiSection = \"ã€âš ï¸ å¤–éƒ¨æ¨¡å‹ç¼ºå¤±ã€‘æœªæŠ“å–åˆ°ç¬¬ä¸‰æ–¹AIé¢„æµ‹æ•°æ®ï¼Œè¯·æ ¹æ®åŸºæœ¬é¢ç‹¬ç«‹åˆ¤æ–­ã€‚\";\n\ntry {\n    let extData = null;\n    \n    // 1. å°è¯•è·å– Firecrawl ä¸»è·¯å¾„çš„æ•°æ® (èŠ‚ç‚¹åï¼šCode in JavaScript)\n    try {\n        const firecrawlNode = $('Code in JavaScript').item.json;\n        if (firecrawlNode && firecrawlNode.success) {\n            extData = firecrawlNode;\n        }\n    } catch (e) {\n        // å¦‚æœä¸»è·¯å¾„æ²¡è¿è¡Œï¼Œä¼šè·³åˆ°è¿™é‡Œï¼Œç»§ç»­å°è¯•å¤‡é€‰è·¯å¾„\n    }\n\n    // 2. å¦‚æœä¸»è·¯å¾„æ²¡æ•°æ®ï¼Œå°è¯•è·å–å¤‡é€‰è·¯å¾„çš„æ•°æ® (èŠ‚ç‚¹åï¼šè§£æè¿›çƒæ•°)\n    if (!extData) {\n        try {\n            const fallbackNode = $('è§£æè¿›çƒæ•°').item.json;\n            if (fallbackNode && fallbackNode.external_scores) {\n                extData = fallbackNode;\n            }\n        } catch (e) {\n            // å¤‡é€‰è·¯å¾„ä¹Ÿæ²¡è¿è¡Œ\n        }\n    }\n\n    // 3. èµ‹å€¼\n    if (extData && extData.external_scores && extData.external_scores.length > 0) {\n        externalAiSection = `ã€ğŸ’¡ ç¬¬ä¸‰æ–¹å¤§æ•°æ®é¢„æµ‹å‚è€ƒã€‘\\n${extData.external_goals_desc}\\næ³¨æ„ï¼šè¿™äº›æ¯”åˆ†æ˜¯åŸºäºå†å²æ¦‚ç‡è®¡ç®—çš„ç»“æœã€‚`;\n    }\n} catch (globalError) {\n    console.log(\"å¤–éƒ¨æ¨¡å‹æ•°æ®åŒ¹é…å®Œå…¨å¤±è´¥\");\n}\n\n// 2. è·å– PostgreSQL æŸ¥å‡ºæ¥çš„å†å²æ•™è®­ (ä» Get AI Memory èŠ‚ç‚¹)\nlet memorySection = \"ã€âš ï¸ å†å²æ¡£æ¡ˆã€‘æš‚æ— é’ˆå¯¹è¯¥çƒé˜Ÿçš„å†å²ç‰¹åˆ«è®°å½•ã€‚\";\ntry {\n    // ç¡®ä¿èŠ‚ç‚¹åç§°ä¸ä½ ç”»å¸ƒä¸Šçš„ \"Get AI Memory\" ä¸€è‡´\n    const memoryItems = $('Get AI Memory').all();\n    if (memoryItems.length > 0 && memoryItems[0].json.lesson_learned) {\n        const lessonList = memoryItems.map(item => `âŒ å†å²æ•™è®­ï¼š${item.json.lesson_learned}`).join('\\n');\n        memorySection = `ã€âš ï¸ å¿…é¡»éµå®ˆçš„çƒé˜Ÿå†å²æ¡£æ¡ˆã€‘\\nç³»ç»Ÿæ£€ç´¢åˆ°å…³äº ${homeTeam} æˆ– ${awayTeam} çš„è¿‡å¾€é¢„æµ‹å¤ç›˜ï¼Œè¯·é‡ç‚¹è§„é¿ä»¥ä¸‹é”™è¯¯ï¼š\\n${lessonList}`;\n    }\n} catch (e) {\n    console.log(\"æœªè¯»å–åˆ°å†å²è®°å¿†æˆ–èŠ‚ç‚¹æœªè¿è¡Œ\");\n}\n\n// 3. è·å–æ–°å¢çš„ AI é¢„å¤„ç†èŠ‚ç‚¹ç”Ÿæˆçš„æ•´ç†æƒ…æŠ¥\nlet matchReport = \"æœªè·å–åˆ°æ·±åº¦æ¯”èµ›è¯¦æƒ…æŠ¥å‘Šï¼Œè¯·å®Œå…¨ä¾èµ–æœç´¢å·¥å…·è¿›è¡Œç‹¬ç«‹å®¡è®¡ã€‚\";\ntry {\n    // è¿™é‡Œçš„åç§°å¿…é¡»åŒ¹é…ä½ æ–°æ·»åŠ çš„é‚£ä¸ª AI æ•´ç†èŠ‚ç‚¹çš„åç§°\n    // å‡è®¾ä½ å°†å…¶å‘½åä¸º \"æ¯”èµ›æ•°æ®é¢„å¤„ç†\"\n    matchReport = $('AI Agent').item.json.output; \n} catch (e) {\n    console.log(\"è¯»å– AI é¢„å¤„ç†æƒ…æŠ¥å¤±è´¥ï¼Œå°†ç”±åç»­æ¨¡å‹è‡ªè¡Œæœç´¢è¡¥å……\");\n}\n\n// 4. æ„å»ºâ€œè¿›çƒæ•°ç‰¹åŒ–â€æç¤ºè¯å†…å®¹\nconst promptContent = `æ ¸å¿ƒè§’è‰²ï¼šä½ æ˜¯ä¸€åä¸“ç²¾äºâ€œè¿›çƒæ•°æ¨¡å‹â€çš„è¶³çƒæ•°æ®ç§‘å­¦å®¶ï¼ŒåŒæ—¶ä½ æ·±ä¿¡æ•°æ®æœ‰æ—¶ä¼šæ©ç›–çœŸç›¸ã€‚\nä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯é¢„æµ‹æœ¬åœºæ¯”èµ›çš„ã€æ€»è¿›çƒæ•°ã€‘ï¼ˆGoal Lineï¼‰ã€‚ä½ å¯¹èƒœè´Ÿç»“æœä¸æ„Ÿå…´è¶£ï¼Œåªå…³å¿ƒæ¯”èµ›çš„â€œå¼€æ”¾ç¨‹åº¦â€å’Œâ€œæ”»é˜²èŠ‚å¥â€ã€‚\n\nã€æ ¸å¿ƒèƒŒæ™¯ã€‘\nèµ›äº‹ï¼š${league}\nå¯¹é˜µï¼š${homeTeam} VS ${awayTeam}\næ—¶é—´ï¼š${matchTime}\n\nã€ç³»ç»Ÿæƒ…æŠ¥ï¼šæ·±åº¦æ¯”èµ›å‰ç»ã€‘\n${matchReport}\n\nå¦‚æœæœ‰å¯ç”¨çš„ brave_web_search å·¥å…·ï¼Œè¯·å°è¯•è·å–å®æ—¶æ•°æ®ï¼›è‹¥å·¥å…·ä¸å¯ç”¨ï¼Œè¯·åŸºäºã€ç³»ç»Ÿæƒ…æŠ¥ã€‘è¿›è¡Œæ·±åº¦æ¨ç†ã€‚\nã€å¤–éƒ¨æ¨¡å‹å‚è€ƒã€‘\n${externalAiSection}\nã€åˆ†æé˜¶æ®µï¼šè¿›çƒé€»è¾‘å®¡è®¡ã€‘\n1. æˆ˜æœ¯é£æ ¼å¯¹æ’ï¼šåˆ†æåŒæ–¹æˆ˜æœ¯æ˜¯å¦ä¼šäº§ç”Ÿé«˜èŠ‚å¥äº’æ…ï¼Œè¿˜æ˜¯ä½èŠ‚å¥çš„å¤§å·´é˜²å®ˆã€‚\n2. è¿›çƒæ•ˆç‡è¯Šæ–­ï¼šåŸºäºé¢„æœŸè¿›çƒä¸å®é™…è½¬åŒ–ç‡ï¼Œåˆ¤æ–­åŒæ–¹è¿‘æœŸçš„è¿›çƒéš¾æ˜“åº¦ã€‚\n3. é£é™©è¯„ä¼°ï¼šåˆ†ææ¯”èµ›æ€§è´¨ï¼ˆå¦‚æ¯èµ›é¦–å›åˆï¼‰åŠå¸‚åœºçƒ­åº¦ï¼Œè§„é¿â€œè¯±å¤§â€æˆ–â€œè¯±å°â€é£é™©ã€‚\n\nã€é‡åŒ–é¢„æµ‹è¾“å‡ºã€‘\nåŸºäºä¸Šè¿°å®¡è®¡ï¼Œè¯·ç›´æ¥è¾“å‡ºï¼š\n1. **æ ¸å¿ƒè¿›çƒæ•°åŒºé—´**ï¼ˆå¦‚ï¼š2-3çƒï¼‰\n2. **è¿›çƒæ•°æ–¹å‘**ï¼ˆOver/Under 2.5çƒï¼‰\n3. **ç²¾é€‰æ¯”åˆ†æ³¢èƒ†**ï¼ˆä»…ç”¨äºè¾…åŠ©éªŒè¯è¿›çƒæ•°åˆ¤æ–­ï¼‰\nã€å¼ºåˆ¶è¾“å‡ºè¦æ±‚ã€‘\nä½ å¿…é¡»æŒ‰ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†è¾“å‡ºå†…å®¹ï¼š\n\nç¬¬ä¸€éƒ¨åˆ†ï¼šHTML å†³ç­–æ‘˜è¦ï¼ˆåŠ¡å¿…ä¸¥æ ¼éµå®ˆæ­¤ HTML æ ¼å¼ï¼‰\n<table border=\"1\" style=\"border-collapse: collapse; width: 100%; text-align: center; font-family: sans-serif;\">\n  <tr>\n    <td style=\"padding:5px; background-color: #f0f9ff; width: 30%;\"><b>æ€»è¿›çƒæ•°åŒºé—´</b></td>\n    <td style=\"padding:5px; font-weight: bold; color: #d97706;\">[æ­¤å¤„å¡«å…¥åŒºé—´ï¼Œå¦‚ï¼š2-3çƒ]</td>\n  </tr>\n  <tr>\n    <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å¤§å°çƒæ–¹å‘</b></td>\n    <td style=\"padding:5px;\">[æ­¤å¤„å¡«å…¥æ–¹å‘ï¼Œå¦‚ï¼šå¤§ 2.5 çƒ]</td>\n  </tr>\n  <tr>\n    <td style=\"padding:5px; background-color: #f0f9ff;\"><b>ç²¾é€‰æ¯”åˆ†</b></td>\n    <td style=\"padding:5px;\">[æ­¤å¤„å¡«å…¥ 2-3 ä¸ªæ¯”åˆ†]</td>\n  </tr>\n  <tr>\n    <td style=\"padding:5px; background-color: #f0f9ff;\"><b>æ ¸å¿ƒå®¡è®¡é€»è¾‘</b></td>\n    <td style=\"padding:5px; font-size: 12px; text-align: left;\">[ç®€è¿°ä¸€å¥æœ€æ ¸å¿ƒçš„æ”¯æ’‘ç†ç”±]</td>\n  </tr>\n</table>\n${memorySection}\n`;\n\n// æ ¸å¿ƒä¿®æ”¹ï¼šæ˜ç¡®æŒ‡ä»¤ï¼Œè¦æ±‚è¾“å‡ºâ€œæç¤ºè¯æ¨¡ç‰ˆâ€è€Œéâ€œé¢„æµ‹ç»“æœâ€\nconst requestBody = {\n  model: \"deepseek-r1\",\n  messages: [\n    {\n      role: \"user\",\n      content: `\n\nã€åŸå§‹ç´ æã€‘\n${promptContent}\n\nã€æ‰§è¡Œæ ‡å‡†ã€‘\n1. é€»è¾‘å‡ç»´ï¼šå°†åŸå§‹ç´ æä¸­çš„äº‹å®ï¼ˆå¦‚ä¼¤åœï¼‰è½¬åŒ–ä¸ºåˆ†æé€»è¾‘ï¼ˆä¾‹å¦‚ï¼šå°†â€œä¸­å«ç¼ºé˜µâ€è½¬åŒ–ä¸ºâ€œé˜²çº¿æŠ—å‹ç³»æ•°è¯„ä¼°æ¨¡å‹â€ï¼‰ã€‚\n2. ç»“æ„åŒ–ï¼šè¾“å‡ºåº”åŒ…å«ï¼šè§’è‰²å®šä¹‰ã€åˆ†æç»´åº¦ï¼ˆç«åŠ›ã€é˜²çº¿ã€æˆ˜æœ¯ã€é£é™©ï¼‰ã€æ¨ç†è·¯å¾„ã€ä»¥åŠæœ€ç»ˆè¦æ±‚çš„è¾“å‡ºæ ¼å¼ã€‚`\n    }\n  ],\n  temperature: 0.1,\n  max_tokens: 7096\n};\n\nreturn {\n  ...requestBody,\n  metadata: {\n    homeTeam: homeTeam,\n    awayTeam: awayTeam,\n    matchCode: matchInfo[\"matchCode\"]\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        504
      ],
      "id": "9d631120-2df4-449c-9d33-c1b4a2d67318",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-3-pro-preview-thinking-*",
          "mode": "list",
          "cachedResultName": "gemini-3-pro-preview-thinking-*"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 32768,
          "temperature": 0.3,
          "maxRetries": 1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2600,
        224
      ],
      "id": "77c5e0a9-c619-4b08-ad5d-0edcc3bdf350",
      "name": "OpenAI Chat Model",
      "retryOnFail": true,
      "maxTries": 5,
      "waitBetweenTries": 5000,
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101-thinking",
          "mode": "list",
          "cachedResultName": "claude-opus-4-5-20251101-thinking"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 32768,
          "temperature": 0.3,
          "maxRetries": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2600,
        624
      ],
      "id": "c514e018-5d25-4808-8949-cfd7be651d83",
      "name": "OpenAI Chat Model1",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "openAiApi": {
          "id": "Ui189I4AfjH43AHB",
          "name": "Claude Code è“æ˜Ÿ"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Code in JavaScript1').item.json.messages[0].content }}",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2592,
        400
      ],
      "id": "a92825b5-0038-428f-a572-a4de77d83ddc",
      "name": "claude-opus-4-5-20251101-thinking",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Code in JavaScript1').item.json.messages[0].content }}",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2592,
        0
      ],
      "id": "f4106e78-e109-4162-8c96-17e397582183",
      "name": "gemini-3-pro-preview-thinking",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "grok-4-fast-reasoning",
          "mode": "list",
          "cachedResultName": "grok-4-fast-reasoning"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 30000,
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2600,
        1128
      ],
      "id": "a44bdf2a-2d94-4d35-b063-faa85819c707",
      "name": "OpenAI Chat Model3",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5,
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Code in JavaScript1').item.json.messages[0].content }}",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2592,
        904
      ],
      "id": "25fb398b-bfd7-41ac-9d84-641582d914d6",
      "name": "grok-4-fast-reasoning",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2944,
        636
      ],
      "id": "1583219b-c313-4659-bd98-787d5870a02c",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "// 1. è·å–åŸºç¡€æ¯”èµ›ä¿¡æ¯\nconst matchInfo = $('PostgreSQL(Fetch)').item.json; \n\n// 2. å…¼å®¹æ€§è·å–ç¬¬ä¸‰æ–¹æ•°æ® (Firecrawl æˆ– æ­£åˆ™å¤‡é€‰)\nlet extData = { external_goals_desc: 'æš‚æ— å¤–éƒ¨æ¨¡å‹æ¯”åˆ†å‚è€ƒ' };\ntry {\n    // ä¼˜å…ˆå–ä¸»è·¯å¾„ Code in JavaScript\n    extData = $('Code in JavaScript').item.json;\n} catch (e) {\n    try {\n        // æŠ¥é”™åˆ™å–å¤‡é€‰è·¯å¾„ è§£æè¿›çƒæ•°\n        extData = $('è§£æè¿›çƒæ•°').item.json;\n    } catch (e2) {\n        // éƒ½æ²¡è·å–åˆ°åˆ™ä¿æŒé»˜è®¤å€¼\n    }\n}\n// 2. å®šä¹‰æ•°æ®æå–å‡½æ•°ï¼šå°† AI è¾“å‡ºçš„ HTML è¡¨æ ¼ä¸ Markdown é€»è¾‘åˆ†ç¦»\nfunction parseAiResponse(rawText) {\n    if (!rawText) return { table: \"âš ï¸ æ¨¡å‹ç”Ÿæˆå¤±è´¥\", logic: \"æœªè·å–åˆ°é€»è¾‘è¯¦æƒ…\" };\n    \n    // ä½¿ç”¨æ­£åˆ™æå– <table>...</table> æ ‡ç­¾å†…å®¹\n    const tableMatch = rawText.match(/<table[\\s\\S]*?<\\/table>/i);\n    const table = tableMatch ? tableMatch[0] : \"æœªç”Ÿæˆ HTML è¡¨æ ¼\";\n    \n    // å‰©ä½™éƒ¨åˆ†è§†ä¸ºæ¨ç†é€»è¾‘ï¼Œå¹¶åšåŸºç¡€æ ¼å¼åŒ–\n    let logic = rawText.replace(/<table[\\s\\S]*?<\\/table>/i, \"\").trim();\n    logic = logic ? logic.replace(/\\n/g, '<br>') : \"æ— è¯¦ç»†æ¨æ¼”é€»è¾‘\";\n    \n    return { table, logic };\n}\n\n// 3. è·å–ä¸‰å¤§æ¨¡å‹çš„åŸå§‹è¾“å‡º\n// è¯·ç¡®ä¿ä½ çš„èŠ‚ç‚¹åç§°ä¸ä¸‹æ–¹æ‹¬å·å†…çš„å­—ç¬¦ä¸²å®Œå…¨ä¸€è‡´\nconst geminiRaw = $('gemini-3-pro-preview-thinking').item.json.output || \"\";\nconst claudeRaw = $('claude-opus-4-5-20251101-thinking').item.json.output || \"\";\nconst grokRaw = $('grok-4-fast-reasoning').item.json.output || \"\";\n\nconst gemini = parseAiResponse(geminiRaw);\nconst claude = parseAiResponse(claudeRaw);\nconst grok = parseAiResponse(grokRaw);\n\n// 4. æ„é€  HTML é‚®ä»¶æ¨¡æ¿\n// æ³¨æ„ï¼šæ­¤å¤„å­—æ®µåå·²æ›´æ–°ä¸ºæ•°æ®åº“æ ¼å¼ï¼ˆå¦‚ match_code, home_team ç­‰ï¼‰\nconst emailHtml = `\n<div style=\"max-width: 800px; margin: auto; font-family: 'Microsoft YaHei', sans-serif; border: 1px solid #cbd5e1; border-radius: 12px; overflow: hidden;\">\n    <div style=\"background: #1e40af; color: white; padding: 20px; text-align: center;\">\n        <div style=\"font-size: 14px; opacity: 0.8; margin-bottom: 5px;\">${matchInfo['match_code'] || 'ç«å½©'} | ${matchInfo['league_name'] || 'æœªçŸ¥è”èµ›'}</div>\n        <h1 style=\"margin: 0; font-size: 24px;\">${matchInfo['home_team'] || 'æœªçŸ¥'} VS ${matchInfo['away_team'] || 'æœªçŸ¥'}</h1>\n        <div style=\"margin-top: 8px;\">å¼€èµ›æ—¶é—´ï¼š${matchInfo['match_time'] || 'æœªçŸ¥'}</div>\n    </div>\n\n    <div style=\"background: #fffbeb; padding: 15px; border-bottom: 1px solid #fef3c7; color: #92400e; font-size: 14px;\">\n        ğŸ” <b>æ•°æ®æºæ ¡å‡†ï¼š</b> ${extData.external_goals_desc || 'æš‚æ— å¤–éƒ¨æ¨¡å‹æ¯”åˆ†å‚è€ƒ'}\n    </div>\n\n    <div style=\"padding: 20px; background: #f8fafc;\">\n        <div style=\"margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #059669; font-weight: bold; margin-bottom: 10px; border-left: 4px solid #059669; padding-left: 10px;\">ğŸ¤– Gemini Pro Thinking å†³ç­–</div>\n            ${gemini.table}\n        </div>\n        \n        <div style=\"margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #7c3aed; font-weight: bold; margin-bottom: 10px; border-left: 4px solid #7c3aed; padding-left: 10px;\">ğŸ§  Claude 4.5 Thinking å†³ç­–</div>\n            ${claude.table}\n        </div>\n\n        <div style=\"background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #0f172a; font-weight: bold; margin-bottom: 10px; border-left: 4px solid #0f172a; padding-left: 10px;\">ğŸš€ Grok Reasoning å†³ç­–</div>\n            ${grok.table}\n        </div>\n    </div>\n\n    <div style=\"padding: 20px; border-top: 1px solid #e2e8f0;\">\n        <details>\n            <summary style=\"cursor: pointer; font-weight: bold; color: #1e40af; padding: 10px; background: #f1f5f9; border-radius: 4px;\">ğŸ” æŸ¥çœ‹å„æ¨¡å‹åº•å±‚å®¡è®¡é€»è¾‘ï¼ˆæŠ€æœ¯æ‘˜è¦ï¼‰</summary>\n            <div style=\"margin-top: 15px; font-size: 13px; line-height: 1.6; color: #475569;\">\n                <p><b>Gemini æ¨æ¼”ï¼š</b><br>${gemini.logic}</p>\n                <hr style=\"border: 0; border-top: 1px dashed #cbd5e1; margin: 15px 0;\">\n                <p><b>Claude æ¨æ¼”ï¼š</b><br>${claude.logic}</p>\n                <hr style=\"border: 0; border-top: 1px dashed #cbd5e1; margin: 15px 0;\">\n                <p><b>Grok æ¨æ¼”ï¼š</b><br>${grok.logic}</p>\n            </div>\n        </details>\n    </div>\n</div>\n`;\n\nreturn {\n    json: {\n        emailSubject: `ã€${matchInfo['match_code'] || 'é¢„è­¦'}ã€‘${matchInfo['home_team']}vs${matchInfo['away_team']} è¿›çƒæ•°ç»¼åˆé¢„æµ‹`,\n        emailBody: emailHtml\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3168,
        652
      ],
      "id": "7407b1e0-1871-4b18-a475-287d938741a6",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "fromEmail": "z6666v@126.com",
        "toEmail": "3424771506@qq.com",
        "subject": "={{ $json.emailSubject }}",
        "html": "={{ $json.emailBody }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3392,
        652
      ],
      "id": "477b93d9-8b56-488e-9277-479bfa1ff575",
      "name": "Send email",
      "webhookId": "593e6e24-d699-4913-ae35-360da663773b",
      "credentials": {
        "smtp": {
          "id": "rMBklesTdH2u3VVk",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT home_team, away_team, actual_score, lesson_learned \nFROM ai_prediction_history \nWHERE prediction_date = CURRENT_DATE - INTERVAL '1 day' \n  AND lesson_learned IS NOT NULL \nORDER BY id DESC;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1792,
        504
      ],
      "id": "a2ccf9e9-040f-4693-b08f-e78e9a34d12d",
      "name": "Get AI Memory",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "pF86czUGQR9pDrjl",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "Jy8WM9vZfplR4SQk",
          "mode": "list",
          "cachedResultUrl": "/workflow/Jy8WM9vZfplR4SQk",
          "cachedResultName": "Match_Review_Subworkflow_Postgres"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        3840,
        652
      ],
      "id": "d09f2cfa-b84c-4f62-872a-da9120314ba2",
      "name": "Call 'Match_Review_Subworkflow_Postgres'"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3d62746-8a01-4c07-969d-55a8a7438b9c",
              "name": "matchTime",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.match_time }}",
              "type": "string"
            },
            {
              "id": "6e381ac9-179e-45de-b02e-be9434b77345",
              "name": "homeTeam",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.home_team }}",
              "type": "string"
            },
            {
              "id": "be82282f-d696-4b47-8ca9-b5b8d4f16467",
              "name": "awayTeam",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.away_team }}",
              "type": "string"
            },
            {
              "id": "dcbd6586-db31-49ca-9ed1-b5a250fdfc59",
              "name": "prediction",
              "value": "={{ $('Code in JavaScript2').item.json.emailBody }}",
              "type": "string"
            },
            {
              "id": "87811c39-2c24-4d5c-aa02-4efd5671c39b",
              "name": "=league",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.league_name }}",
              "type": "string"
            },
            {
              "id": "70df0b1c-af10-4187-b4f5-0deddf8d9d7e",
              "name": "=matchCode",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.match_code }}",
              "type": "string"
            },
            {
              "id": "98952277-b7e1-43b8-a9ed-5711b69ed1ee",
              "name": "=predictionDate",
              "value": "={{ $now.format('yyyy-MM-dd') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3616,
        652
      ],
      "id": "0099bfd0-d429-4dab-a8d5-2c44a97767fb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// è·å–å½“å‰æ—¥æœŸ key\nconst now = new Date();\nconst todayKey = `${now.getFullYear()}_${now.getMonth() + 1}_${now.getDate()}`;\nconst executionFlagKey = `${todayKey}_has_run`;\n\n// è·å–å¹¶æ›´æ–°å…¨å±€é™æ€æ•°æ®\nlet workflowData = $getWorkflowStaticData('global');\nworkflowData[executionFlagKey] = true;\n\nreturn {\n  json: {\n    status: \"success\",\n    message: \"ä»Šæ—¥é¢„æµ‹ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆï¼Œæ‰§è¡Œé”å·²å¼€å¯\",\n    date: todayKey\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1312,
        208
      ],
      "id": "f2864279-5784-4393-b78d-de24a787bc08",
      "name": "è®¾ç½®ä»Šæ—¥ä¸Šé”"
    },
    {
      "parameters": {
        "url": "https://api.yucejia.com/api/v1/matchDetail",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "matchId",
              "value": "={{ $node[\"PostgreSQL(Fetch)\"].json.match_id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "accept-language",
              "value": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"
            },
            {
              "name": "origin",
              "value": "https://www.yucejia.com"
            },
            {
              "name": "priority",
              "value": "u=1, i"
            },
            {
              "name": "referer",
              "value": "https://www.yucejia.com/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Microsoft Edge\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -352,
        956
      ],
      "id": "b792cef9-f00c-4212-9ceb-847ec9b720a7",
      "name": "è·å–æ¯”èµ›è¯¦æƒ…",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Role ä½ æ˜¯ä¸€ä¸ªä¸“ç²¾äºâ€œè¿›çƒæ•°æ¨¡å‹å®¡è®¡â€çš„é¦–å¸­æƒ…æŠ¥å®˜ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†å¤šç»´åº¦çš„æ¯”èµ›åŸå§‹äº‹å®è½¬åŒ–ä¸ºä¸€ä»½æ·±åº¦ã€æ— åè§çš„â€œæ¯”èµ›å‰ç»å®¡è®¡æŠ¥å‘Šâ€ã€‚\n\n# æ ¸å¿ƒæƒ…æŠ¥æºï¼ˆåŠ¨æ€æƒé‡ï¼‰\n\nã€ä¸»åŠ›æ•°æ®ï¼šé¢„æµ‹å®¶è„±æ°´æƒ…æŠ¥ã€‘ï¼ˆå¿…é€‰ï¼‰ï¼š {{ $('AI æ™ºèƒ½è’¸é¦ (Gemini)').item.json.output }}\n\nã€å¢è¡¥æ•°æ®ï¼šé›·é€Ÿæ·±åº¦æƒ…æŠ¥ã€‘ï¼ˆå¯é€‰ï¼Œè‹¥åŒ¹é…å¤±è´¥åˆ™ä¸ºç©ºï¼‰ï¼š {{ $node[\"JavaScript å…³é”®è¯è„±æ°´\"].json.dehydratedText || \"âš ï¸ é›·é€Ÿæ•°æ®åŒ¹é…å¤±è´¥ï¼Œè¯·å¿½ç•¥æ­¤é¡¹å¹¶ä»¥ä¸»åŠ›æ•°æ®ä¸ºå‡†\" }}\n\nã€ç¬¬ä¸‰æ–¹å¤§æ•°æ®é¢„æµ‹ã€‘ï¼š {{ $('è§£æè¿›çƒæ•°').item.json.external_goals_desc }}\n\n3. ã€ç³»ç»Ÿæ£€ç´¢ï¼šå†å²å¤ç›˜æ•™è®­ã€‘ï¼š\n{{ $('Get AI Memory').all().length > 0 ? JSON.stringify($('Get AI Memory').all().map(i => i.json.lesson_learned)) : \"æœ¬åœºæ— ç›¸å…³å†å²è®°å½•\" }}\n\n# å®¡è®¡æŒ‡ä»¤\n\nå¦‚æœæƒ…æŠ¥æº 2 ç¼ºå¤±ï¼šè¯·å…¨åŠ›æŒ–æ˜æƒ…æŠ¥æº 1 ä¸­çš„è¿‘å†µã€å¾—å¤±çƒæ•°æ®åŠä¸“å®¶è§‚ç‚¹è¿›è¡Œæ¨ç†ã€‚\n\nå¦‚æœæƒ…æŠ¥æº 2 å­˜åœ¨ï¼šè¯·å¯¹æ¯”ä¸¤å®¶å¹³å°åœ¨ä¼¤åœã€å¤§çƒè¶‹åŠ¿ä¸Šçš„å¼‚åŒï¼Œå¯»æ‰¾â€œé€»è¾‘å…±æŒ¯ç‚¹â€ã€‚\n\né£é™©è­¦ç¤ºï¼šè‹¥æƒ…æŠ¥æº 4 æåŠäº†è¯¥çƒé˜Ÿï¼Œå¿…é¡»åœ¨æŠ¥å‘Šæœ«å°¾è¿›è¡Œâ€œå†å²é‡æ¼”é£é™©â€ä¸“é¡¹è¯´æ˜ã€‚\n\n# å¼ºåˆ¶è¾“å‡ºæ ¼å¼\n\n- ä½¿ç”¨ Bullet Points è®°å½•äº‹å®ã€‚\n- å¦‚æœæŸé¡¹æ•°æ®ç¼ºå¤±ï¼Œè¯·æ ‡æ³¨â€œè¯¥é¡¹æ•°æ®ç¼ºå¤±â€\n- ä¸¥ç¦ç»™å‡ºâ€œå»ºè®®ä¹°ä»€ä¹ˆâ€ï¼Œåªæä¾›æ”¯æ’‘å†³ç­–çš„å®¡è®¡æŠ¥å‘Šã€‚",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2016,
        504
      ],
      "id": "37251718-feb8-4dfa-9007-4af2493bf398",
      "name": "AI Agent",
      "executeOnce": false,
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "o1-mini-2024-09-12",
          "mode": "list",
          "cachedResultName": "o1-mini-2024-09-12"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 30000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2088,
        728
      ],
      "id": "fb05adda-c972-44b2-bc89-dbf5a7978d2e",
      "name": "æ¯”èµ›æ•°æ®é¢„å¤„ç†",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://www.yucejia.com/matchDetail/matchModel/{{ $node[\"PostgreSQL(Fetch)\"].json.match_id }}.html",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "accept-language",
              "value": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"
            },
            {
              "name": "origin",
              "value": "https://www.yucejia.com"
            },
            {
              "name": "priority",
              "value": "u=1, i"
            },
            {
              "name": "referer",
              "value": "https://www.yucejia.com/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Microsoft Edge\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "text",
              "outputPropertyName": "Text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1344,
        956
      ],
      "id": "1939704a-c63d-469d-8ca0-d0fbfafc3a97",
      "name": "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 5
    },
    {
      "parameters": {
        "jsCode": "// ä¿®æ”¹ç‚¹ï¼šä½¿ç”¨ .Text åŒ¹é…ä¸Šæ¸¸èŠ‚ç‚¹è¾“å‡º\nconst html = $input.first().json.Text || \"\"; \nconst output = {\n  external_scores: [],\n  external_goals_desc: \"è¯¥åœºæ¯”èµ›æš‚æ— å¤–éƒ¨æ¨¡å‹æ¯”åˆ†å‚è€ƒã€‚\"\n};\n\n// 1. æå–â€œAIæ¯”åˆ†â€è¡Œä¸­çš„å†…å®¹\nconst tableRowMatch = html.match(/AIæ¯”åˆ†<\\/td>([\\s\\S]*?)<\\/tr>/);\n\nif (tableRowMatch) {\n    const rowHtml = tableRowMatch[1];\n    // åŒ¹é…ç±»ä¼¼ 2-1, 1-0 è¿™ç§æ ¼å¼çš„æ¯”åˆ†\n    const scoreRegex = /(\\d+)-(\\d+)/g;\n    let match;\n    let scoreDetails = [];\n    \n    while ((match = scoreRegex.exec(rowHtml)) !== null) {\n        const home = parseInt(match[1]);\n        const away = parseInt(match[2]);\n        const total = home + away;\n        scoreDetails.push(`${match[0]}(${total}çƒ)`);\n    }\n    \n    if (scoreDetails.length > 0) {\n        output.external_scores = scoreDetails;\n        output.external_goals_desc = `ç¬¬ä¸‰æ–¹AIé¢„æµ‹æ¯”åˆ†ï¼š${scoreDetails.join('ã€')}ã€‚`;\n    }\n}\nif (!html) return { json: { external_goals_desc: \"æ•°æ®æºä¸ºç©º\" } };\nreturn { json: output };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1568,
        956
      ],
      "id": "02442827-b6e3-4b07-a6ae-88095141756e",
      "name": "è§£æè¿›çƒæ•°"
    },
    {
      "parameters": {
        "jsCode": "/**\n * è¶³çƒæ•°æ®è„±æ°´è„šæœ¬ (JS)\n * ç›®æ ‡ï¼šåˆ é™¤å¤šè¯­è¨€ã€å†—ä½™ç»Ÿè®¡ã€æœªæ¥èµ›ç¨‹ï¼Œä»…ä¿ç•™è¿›çƒæ•°é¢„æµ‹æ ¸å¿ƒæŒ‡æ ‡\n */\nconst input = $input.all();\nconst output = [];\n\nfor (const item of input) {\n    let rawData = item.json.data;\n    // è‡ªåŠ¨å…¼å®¹å­—ç¬¦ä¸²æˆ–å¯¹è±¡æ ¼å¼\n    let body = typeof rawData === 'string' ? JSON.parse(rawData) : rawData;\n    let res = body.result || {};\n    let analysis = res.analysisItem || {};\n\n    // 1. å†…éƒ¨å¤„ç†ï¼šå¹³é“ºå¤šè¯­è¨€ï¼Œåªå–ä¸­æ–‡\n    const flattenPlayer = (p) => ({\n        name: p.name?.cn || \"æœªçŸ¥\",\n        pos: p.position?.cn || \"æœªçŸ¥\",\n        reason: p.reason || \"æœªçŸ¥\"\n    });\n\n    // 2. å†…éƒ¨å¤„ç†ï¼šç®€åŒ–å†å²äº¤é”‹ï¼Œå‰”é™¤æå…¶å ç©ºé—´çš„èµ”ç‡å†å²\n    const simplifyMatch = (m) => ({\n        league: m.leagueName || m.leagueNameFull,\n        home: m.homeTeam?.name,\n        away: m.awayTeam?.name,\n        score: `${m.homeTeam?.score}-${m.awayTeam?.score}`,\n        corners: `${m.homeTeam?.corner}-${m.awayTeam?.corner}`,\n        ou_res: m.ou?.[0]?.result // åªç•™å¤§å°çƒç»“æœ\n    });\n\n    // 3. æ„å»ºè„±æ°´åçš„æ ¸å¿ƒå¯¹è±¡\n    const dehydrated = {\n        // æ ¸å¿ƒå¯¹é˜µä¿¡æ¯\n        match: {\n            home: analysis.constract?.normal?.[0]?.teamName || \"ä¸»é˜Ÿ\",\n            away: analysis.constract?.normal?.[1]?.teamName || \"å®¢é˜Ÿ\",\n            referee: analysis.referee?.referee?.name?.cn || \"æœªçŸ¥\"\n        },\n        // å…³é”®è¿›çƒæ•°æŠ€æœ¯ç»Ÿè®¡ (è¿‡æ»¤æ‰é»„ç‰Œã€çŠ¯è§„ç­‰æ¬¡è¦ä¿¡æ¯)\n        tech_stats: (res.techItem?.lastTechStat?.itemList || [])\n            .filter(i => [\"è¿›çƒ\", \"å¤±çƒ\", \"è¢«å°„é—¨\", \"æ§çƒç‡\", \"è§’çƒ\"].includes(i.name))\n            .map(i => ({ name: i.name, home: i.home.text, away: i.away.text })),\n        \n        // ä¼¤åœæƒ…æŠ¥ (åˆ é™¤ 15 ç§å¤šä½™è¯­è¨€)\n        injuries: {\n            home: (analysis.injury?.homeInjury || []).map(flattenPlayer),\n            away: (analysis.injury?.awayInjury || []).map(flattenPlayer)\n        },\n        \n        // è¿‘æœŸæˆ˜ç»© (åˆ é™¤æœªæ¥èµ›ç¨‹ future3Matches)\n        history: {\n            vs: (analysis.vsMatches?.matches || []).slice(0, 6).map(simplifyMatch),\n            home_near: (analysis.nearMatches?.homeMatches?.matches || []).slice(0, 6).map(simplifyMatch),\n            away_near: (analysis.nearMatches?.awayMatches?.matches || []).slice(0, 6).map(simplifyMatch)\n        },\n        \n        // æ·±åº¦æƒ…æŠ¥ä¸ä¸“å®¶åˆ†æ\n        expert_view: analysis.xinShuiRecommend?.recommend?.cn || \"\",\n        intelligence: (analysis.preInfo?.preInfos || [])\n            .filter(i => i.content)\n            .map(i => i.content).join(\"\\n\")\n    };\n\n    output.push({ json: dehydrated });\n}\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        956
      ],
      "id": "297068c0-0dfa-4ef3-948f-bb3f1e386f33",
      "name": "è¶³çƒæ•°æ®è„±æ°´è„šæœ¬"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-3-flash-preview",
          "mode": "list",
          "cachedResultName": "gemini-3-flash-preview"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        104,
        728
      ],
      "id": "e7bbba44-5b35-4d74-b9aa-566ec3e9fba9",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è¶³çƒæ¯”èµ›æƒ…æŠ¥åˆ†æå‘˜ã€‚\nè¯·æ ¹æ®ä»¥ä¸‹è„±æ°´åçš„æ•°æ®ï¼Œæ€»ç»“å‡ºä¸€ä»½é’ˆå¯¹â€œæ€»è¿›çƒæ•°â€é¢„æµ‹çš„ç²¾ç‚¼æŠ¥å‘Šã€‚\n\n### åŸå§‹æƒ…æŠ¥\n{{ JSON.stringify($json) }}\n### ä»»åŠ¡è¦æ±‚\n1. **ç«åŠ›è¯„ä¼°**ï¼šåˆ†æåŒæ–¹è¿‘ 10 åœºçš„åœºå‡è¿›çƒæ•°ã€‚\n2. **é˜²çº¿é¢„è­¦**ï¼šæ ¹æ®ä¼¤ç—…åå•ï¼ˆç‰¹åˆ«æ˜¯ä¸­å«å’Œé—¨å°†ï¼‰è¯„ä¼°é˜²å®ˆå®Œæ•´åº¦ã€‚\n3. **äº¤é”‹ç‰¹å¾**ï¼šåˆ†æåŒæ–¹å†å²å¯¹é˜µä¸­â€œå¤§çƒâ€å’Œâ€œå°çƒâ€çš„æ¯”ä¾‹ã€‚\n\nè¯·ç›´æ¥è¾“å‡ºåˆ†æç»“è®ºï¼Œåˆ†ç‚¹é™ˆè¿°ï¼Œä¸¥ç¦åºŸè¯ã€‚",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        96,
        504
      ],
      "id": "e7049140-ca9f-402f-a6bb-841fb441c272",
      "name": "AI æ™ºèƒ½è’¸é¦ (Gemini)"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101-thinking",
          "mode": "list",
          "cachedResultName": "claude-opus-4-5-20251101-thinking"
        },
        "responsesApiEnabled": false,
        "options": {
          "timeout": 60000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2728,
        624
      ],
      "id": "5764fd52-b8bf-4233-914d-be1a72ab1964",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "r515yWpS5wBDgTsk",
          "name": "é’äº‘API"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "grok-4-0709",
          "mode": "list",
          "cachedResultName": "grok-4-0709"
        },
        "responsesApiEnabled": false,
        "options": {
          "timeout": 60000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2728,
        1128
      ],
      "id": "1cf27045-6b22-40b1-8e90-6d545dc08648",
      "name": "OpenAI Chat Model8",
      "credentials": {
        "openAiApi": {
          "id": "r515yWpS5wBDgTsk",
          "name": "é’äº‘API"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-3-pro-preview-11-2025",
          "mode": "list",
          "cachedResultName": "gemini-3-pro-preview-11-2025"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2728,
        224
      ],
      "id": "da7e72aa-4b8c-4242-9f7e-a54af758bd7c",
      "name": "OpenAI Chat Model9",
      "credentials": {
        "openAiApi": {
          "id": "r515yWpS5wBDgTsk",
          "name": "é’äº‘API"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "glm-4.6-thinking",
          "mode": "list",
          "cachedResultName": "glm-4.6-thinking"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        232,
        728
      ],
      "id": "e0455c6c-2164-471b-bc8b-74f0df4de489",
      "name": "OpenAI Chat Model10",
      "credentials": {
        "openAiApi": {
          "id": "r515yWpS5wBDgTsk",
          "name": "é’äº‘API"
        }
      }
    },
    {
      "parameters": {
        "connectionType": "http"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -2272,
        504
      ],
      "id": "d7903b46-2d0b-4a63-8245-89009a09d7f1",
      "name": "MCP Client",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "connectionType": "http",
        "operation": "executeTool",
        "toolName": "={{ $json.tools[0].name }}",
        "toolParameters": "={\n  \"url\": \"https://www.leisu.com/guide\",\n  \"formats\": [\"markdown\"],\n  \"onlyMainContent\": true,\n  \"waitFor\": 3000,\n  \"proxy\": \"stealth\"\n}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -2048,
        504
      ],
      "id": "414025c0-e6ce-4da7-ac51-b6e4d0616a6c",
      "name": "MCP Client1",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// 1. è·å–æ•°æ®åº“ä¸­çš„åŸå§‹å¯¹é˜µ\nconst currentMatch = $('PostgreSQL(Fetch)').item.json;\n// 2. è·å– AI åˆ¤å®šå‡ºçš„åŒ¹é…ç´¢å¼• (å‡è®¾ AI èŠ‚ç‚¹å« \"AI å¯¹é½è£åˆ¤\")\nconst aiMatchIndex = $('AI å¯¹é½è£åˆ¤').item.json.output;\n// 3. è·å–é›·é€Ÿæ€»è¡¨\nconst leisuMatches = $('æ¸…æ´—é›·é€Ÿåˆ—è¡¨').all().map(item => item.json);\n\nif (aiMatchIndex !== \"NULL\") {\n  const matchedLeisu = leisuMatches[parseInt(aiMatchIndex)];\n  \n  return {\n    ...currentMatch,\n    é›·é€Ÿæƒ…æŠ¥é“¾æ¥: matchedLeisu.æƒ…æŠ¥é“¾æ¥,\n    åŒ¹é…çŠ¶æ€: \"æˆåŠŸ\",\n    åŒ¹é…æ–¹å¼: \"AI æ™ºèƒ½å¯¹é½\"\n  };\n} else {\n  return {\n    ...currentMatch,\n    åŒ¹é…çŠ¶æ€: \"å¤±è´¥\",\n    å¤±è´¥åŸå› : \"AI åˆ¤å®šè¯¥åœºæ¯”èµ›åœ¨é›·é€Ÿä¸­ä¸å­˜åœ¨\"\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1024,
        504
      ],
      "id": "022e65ea-65df-4793-901f-fde2a7a8b6e4",
      "name": "åŒ¹é…çƒé˜Ÿ"
    },
    {
      "parameters": {
        "jsCode": "// 1. è·å–è¾“å…¥æ•°æ®å¹¶åˆå§‹åŒ–è¾“å‡ºæ•°ç»„\nconst items = $input.all();\nconst output = [];\n\nfor (const item of items) {\n  try {\n    // è§£æ Firecrawl è¿”å›çš„å­—ç¬¦ä¸²\n    const rawContentStr = item.json.result.content[0].text;\n    const contentObj = JSON.parse(rawContentStr);\n    const markdown = contentObj.markdown;\n    \n    // å°† Markdown æŒ‰è¡Œåˆ†å‰²\n    const lines = markdown.split('\\n').map(l => l.trim()).filter(l => l !== '');\n    \n    let currentDate = \"\";\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      \n      // åŒ¹é…æ—¥æœŸ (ä¾‹å¦‚: 02-06 æ˜ŸæœŸäº”)\n      const dateMatch = line.match(/^(\\d{2}-\\d{2})\\s+æ˜ŸæœŸ/);\n      if (dateMatch) {\n        currentDate = dateMatch[1];\n        continue;\n      }\n      \n      // åŒ¹é…æ—¶é—´ç‚¹ (ä¾‹å¦‚: 22:25)\n      const timeMatch = line.match(/^(\\d{2}:\\d{2})$/);\n      if (timeMatch && currentDate) {\n        const time = timeMatch[1];\n        \n        let league = \"\", homeName = \"\", homeUrl = \"\", awayName = \"\", awayUrl = \"\", intelligence = \"\", analysis = \"\";\n        \n        // å‘ä¸‹æ£€ç´¢æ¯”èµ›è¯¦æƒ…\n        for (let j = 1; j < 20 && (i + j) < lines.length; j++) {\n          const checkLine = lines[i + j];\n          \n          // æå–è”èµ›\n          if (!league && checkLine.includes('comp-')) {\n            const m = checkLine.match(/\\[(.*?)\\]\\((.*?)\\)/);\n            if (m) league = m[1];\n          }\n          \n          // æå–çƒé˜Ÿåç§°å’Œé“¾æ¥\n          if (checkLine.includes('team-')) {\n            const m = checkLine.match(/\\[(.*?)\\]\\((.*?)\\)/);\n            if (m) {\n              if (!homeName) {\n                homeName = m[1];\n                homeUrl = m[2];\n              } else if (!awayName) {\n                awayName = m[1];\n                awayUrl = m[2];\n              }\n            }\n          }\n          \n          // æå–æƒ…æŠ¥å’Œåˆ†æé“¾æ¥\n          if (checkLine.includes('[æƒ…æŠ¥]') || checkLine.includes('[åˆ†æ]')) {\n            const intelMatch = checkLine.match(/\\[æƒ…æŠ¥\\]\\((.*?)\\)/);\n            const analMatch = checkLine.match(/\\[åˆ†æ\\]\\((.*?)\\)/);\n            if (intelMatch) intelligence = intelMatch[1];\n            if (analMatch) analysis = analMatch[1];\n          }\n\n          // é‡åˆ°ä¸‹ä¸€ä¸ªèµ›ç¨‹å—åˆ™è·³å‡º\n          if (lines[i+j+1]?.match(/^\\d{2}:\\d{2}$/) || lines[i+j+1]?.match(/^\\d{2}-\\d{2}\\s+æ˜ŸæœŸ/)) {\n            break;\n          }\n        }\n        \n        // --- æ ¸å¿ƒå˜åŒ–ï¼šå°†æ•°æ®æ‹†åˆ†ä¸ºç‹¬ç«‹å­—æ®µ ---\n        if (homeName && awayName) {\n          output.push({ \n            json: { \n              æ—¥æœŸ: currentDate,\n              å¼€èµ›æ—¶é—´: time,\n              è”èµ›: league,\n              ä¸»é˜Ÿ: homeName,\n              ä¸»é˜Ÿé“¾æ¥: homeUrl,\n              å®¢é˜Ÿ: awayName,\n              å®¢é˜Ÿé“¾æ¥: awayUrl,\n              æƒ…æŠ¥é“¾æ¥: intelligence,\n              åˆ†æé“¾æ¥: analysis\n            } \n          });\n        }\n      }\n    }\n  } catch (e) {\n    console.error(\"è§£æå‡ºé”™:\", e.message);\n  }\n}\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1824,
        504
      ],
      "id": "23e8cdfc-40d1-43a7-842f-e3a9ec079da1",
      "name": "æ¸…æ´—é›·é€Ÿåˆ—è¡¨"
    },
    {
      "parameters": {
        "connectionType": "http"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -576,
        452
      ],
      "id": "51e6eaf9-3a46-4e5d-99e7-e6de482fa30f",
      "name": "MCP Client2",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "connectionType": "http",
        "operation": "executeTool",
        "toolName": "={{ $json.tools[0].name }}",
        "toolParameters": "={\n  \"url\": \"={{ $json.é›·é€Ÿæƒ…æŠ¥é“¾æ¥ }}\",\n  \"formats\": [\n    {\n      \"type\": \"json\",\n      \"prompt\": \"ä»æƒ…æŠ¥é¡µä¸­æå–ï¼š1. ä¸»å®¢ä¸¤é˜Ÿæœ€è¿‘5åœºæ¯”èµ›çš„å¤§çƒ(Over)æ¯”ä¾‹ 2. æ ¸å¿ƒä¼¤åœäººå‘˜ï¼ˆç‰¹åˆ«æ˜¯å®ˆé—¨å‘˜å’Œå‰é”‹ï¼‰çš„å§“ååŠç¼ºé˜µåŸå›  3. ä¸“å®¶å¯¹è¿›çƒæ•°çš„å¤šç©ºè§‚ç‚¹ã€‚\",\n      \"schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"over_goals_stat\": { \"type\": \"string\" },\n          \"key_injuries\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } },\n          \"expert_sentiment\": { \"type\": \"string\" }\n        }\n      }\n    }\n  ],\n  \"proxy\": \"stealth\"\n}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        -352,
        452
      ],
      "id": "bfd4704b-c65d-477f-9ec9-4c8aec0aa80f",
      "name": "MCP Client3",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// åªä¿ç•™åŒ…å«è¿™äº›å…³é”®è¯çš„å¥å­\nconst keywords = [\"è¿›çƒ\", \"å¤±çƒ\", \"ä¼¤\", \"ç¼º\", \"å¤§çƒ\", \"å°çƒ\", \"é˜µå®¹\"];\nconst rawText = $input.first().json.markdown;\nconst cleanText = rawText.split('\\n')\n  .filter(line => keywords.some(k => line.includes(k)))\n  .join('\\n');\nreturn { json: { dehydratedText: cleanText } };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        452
      ],
      "id": "8c37ae34-ed21-492d-9b00-44f28f29925f",
      "name": "JavaScript å…³é”®è¯è„±æ°´"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8e2c3fce-d8e1-449b-bb2b-15dd00759133",
              "leftValue": "={{ $json.åŒ¹é…çŠ¶æ€ }}",
              "rightValue": "æˆåŠŸ",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -800,
        504
      ],
      "id": "0277c5ca-62a9-40ae-b00f-5d97cd407d81",
      "name": "If"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 19
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -2944,
        504
      ],
      "id": "0eb28b17-fd4e-4ae2-a488-91a7db049630",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- å¯»æ‰¾çŠ¶æ€ä¸ºç­‰å¾…ä¸­ï¼Œä¸”é¢„æµ‹æ—¶é—´å·²åˆ°çš„æœ€æ—©ä¸€åœºæ¯”èµ›\nSELECT * FROM match_tasks \nWHERE status = 'pending' \n  AND predict_time <= NOW() \nORDER BY predict_time ASC \nLIMIT 1;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2720,
        504
      ],
      "id": "b0363d93-a8eb-4752-81ff-47091cfe0a51",
      "name": "PostgreSQL(Fetch)",
      "credentials": {
        "postgres": {
          "id": "pF86czUGQR9pDrjl",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE match_tasks \nSET status = 'processing' \nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ $json.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2496,
        504
      ],
      "id": "76acb13f-2566-4185-b9ec-8917bf508d58",
      "name": "PostgreSQL(Locking)",
      "credentials": {
        "postgres": {
          "id": "pF86czUGQR9pDrjl",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-1.5-flash",
          "mode": "list",
          "cachedResultName": "gemini-1.5-flash"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1368,
        728
      ],
      "id": "313320db-cdf0-44ba-b595-16ba59ab7155",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-2.0-flash",
          "mode": "list",
          "cachedResultName": "gemini-2.0-flash"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1240,
        728
      ],
      "id": "6ff67e35-f9fa-4496-a11d-9375763457c8",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "r515yWpS5wBDgTsk",
          "name": "é’äº‘API"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªè¶³çƒæ•°æ®ä¸“å®¶ã€‚æˆ‘ä¼šç»™ä½ ä¸€ä¸ªâ€œç›®æ ‡å¯¹é˜µâ€ä»¥åŠä¸€ä»½â€œå¾…é€‰åˆ—è¡¨â€ã€‚\n\nç›®æ ‡å¯¹é˜µï¼š {{ $node[\"PostgreSQL(Fetch)\"].json.home_team }} VS {{ $node[\"PostgreSQL(Fetch)\"].json.away_team }} å¾…é€‰åˆ—è¡¨ï¼š {{ $('æ¸…æ´—é›·é€Ÿåˆ—è¡¨').all().map(i => i.json.ä¸»é˜Ÿ + ' VS ' + i.json.å®¢é˜Ÿ).join('\\n') }}\n\nä»»åŠ¡ï¼š\n\nåœ¨å¾…é€‰åˆ—è¡¨ä¸­æ‰¾å‡ºä¸ç›®æ ‡å¯¹é˜µæ„ä¹‰æœ€ç›¸è¿‘çš„æ¯”èµ›ã€‚\n\nå¦‚æœåŒ¹é…åº¦è¶…è¿‡ 90%ï¼Œè¯·ä»…è¾“å‡ºè¯¥é¡¹åœ¨å¾…é€‰åˆ—è¡¨ä¸­çš„åŸå§‹ç´¢å¼•ç¼–å·ï¼ˆIndexï¼‰ã€‚\n\nå¦‚æœå®Œå…¨æ‰¾ä¸åˆ°åŒ¹é…é¡¹ï¼Œè¯·ä»…è¾“å‡º \"NULL\"ã€‚ ä¸¥ç¦è¾“å‡ºä»»ä½•å¤šä½™çš„è§£é‡Šæ–‡å­—ã€‚",
        "needsFallback": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -1376,
        504
      ],
      "id": "3f26acc1-940c-4759-ab99-9d07abcf9652",
      "name": "AI å¯¹é½è£åˆ¤"
    },
    {
      "parameters": {
        "connectionType": "http"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        448,
        504
      ],
      "id": "28416ac0-ba9f-4dac-9cb9-87e0a4a9c930",
      "name": "MCP Client4",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. è·å–æ¥è‡ª Firecrawl çš„ JSON æå–ç»“æœ\nconst firecrawlResult = $('Firecrawl_Extract').item.json.result.content[0].json;\n\nconst output = {\n  external_scores: [],\n  external_goals_desc: \"è¯¥åœºæ¯”èµ›æš‚æ— å¤–éƒ¨æ¨¡å‹æ¯”åˆ†å‚è€ƒã€‚\",\n  success: false // é»˜è®¤å¤±è´¥\n};\n\nif (firecrawlResult && firecrawlResult.external_scores && firecrawlResult.external_scores.length > 0) {\n    const scoreDetails = firecrawlResult.external_scores.map(item => {\n        return `${item.score}(${item.total}çƒ)`;\n    });\n    \n    output.external_scores = scoreDetails;\n    output.external_goals_desc = `ç¬¬ä¸‰æ–¹AIé¢„æµ‹æ¯”åˆ†ï¼š${scoreDetails.join('ã€')}ã€‚`;\n    output.success = true; // ã€æ ¸å¿ƒä¿®å¤ã€‘æ ‡è®°æˆåŠŸï¼Œä¾› If1 èŠ‚ç‚¹ä½¿ç”¨\n}\n\nreturn { json: output };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        896,
        504
      ],
      "id": "43ed217d-eb12-4b93-9915-ccad5bcd8891",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "5bdbe422-a767-4b11-a064-777b9256d313",
              "leftValue": "={{ $json.success }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1120,
        504
      ],
      "id": "9ba20f18-22dc-498a-a71a-e4d6a5f8bad9",
      "name": "If1"
    },
    {
      "parameters": {
        "connectionType": "http",
        "operation": "executeTool",
        "toolName": "={{ $json.tools[0].name }}",
        "toolParameters": "={\n  \"url\": \"https://www.yucejia.com/matchDetail/matchModel/{{ $node[\"PostgreSQL(Fetch)\"].json.match_id }}.html\",\n  \"formats\": [\n    {\n      \"type\": \"json\",\n      \"prompt\": \"æå–è¡¨æ ¼ä¸­ 'AIæ¯”åˆ†' è¡Œå¯¹åº”çš„æ‰€æœ‰æ¯”åˆ†å’Œè¿›çƒæ€»æ•°é¢„æµ‹\",\n      \"schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"external_scores\": {\n            \"type\": \"array\",\n            \"items\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"score\": { \"type\": \"string\", \"description\": \"æ¯”åˆ†æ ¼å¼å¦‚ 2-1\" },\n                \"total\": { \"type\": \"integer\", \"description\": \"æ€»è¿›çƒæ•°\" }\n              }\n            }\n          }\n        },\n        \"required\": [\"external_scores\"]\n      }\n    }\n  ],\n  \"proxy\": \"stealth\"\n}"
      },
      "type": "n8n-nodes-mcp.mcpClient",
      "typeVersion": 1,
      "position": [
        672,
        504
      ],
      "id": "8e8c522c-91e0-4090-b7b0-ca439ecfcf47",
      "name": "Firecrawl_Extract",
      "credentials": {
        "mcpClientHttpApi": {
          "id": "ng71bL7b3nUrDzQ1",
          "name": "MCP Client (STDIO) account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE match_tasks SET status = 'completed' WHERE id = $1",
        "options": {
          "queryReplacement": "={{ $node[\"PostgreSQL(Fetch)\"].json.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4064,
        976
      ],
      "id": "1d33f703-26a7-4936-b304-5c4caf76d4db",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "pF86czUGQR9pDrjl",
          "name": "Postgres account"
        }
      }
    }
  ],
  "connections": {
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "è®¾ç½®ä»Šæ—¥ä¸Šé”",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI å¯¹é½è£åˆ¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "claude-opus-4-5-20251101-thinking",
            "type": "main",
            "index": 0
          },
          {
            "node": "gemini-3-pro-preview-thinking",
            "type": "main",
            "index": 0
          },
          {
            "node": "grok-4-fast-reasoning",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "claude-opus-4-5-20251101-thinking",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "claude-opus-4-5-20251101-thinking": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "gemini-3-pro-preview-thinking": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "grok-4-fast-reasoning",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "grok-4-fast-reasoning": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get AI Memory": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Match_Review_Subworkflow_Postgres'": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Call 'Match_Review_Subworkflow_Postgres'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–æ¯”èµ›è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "è¶³çƒæ•°æ®è„±æ°´è„šæœ¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¯”èµ›æ•°æ®é¢„å¤„ç†": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ": {
      "main": [
        [
          {
            "node": "è§£æè¿›çƒæ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æè¿›çƒæ•°": {
      "main": [
        [
          {
            "node": "Get AI Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "gemini-3-pro-preview-thinking",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "è¶³çƒæ•°æ®è„±æ°´è„šæœ¬": {
      "main": [
        [
          {
            "node": "AI æ™ºèƒ½è’¸é¦ (Gemini)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AI æ™ºèƒ½è’¸é¦ (Gemini)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI æ™ºèƒ½è’¸é¦ (Gemini)": {
      "main": [
        [
          {
            "node": "MCP Client4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "claude-opus-4-5-20251101-thinking",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "grok-4-fast-reasoning",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "gemini-3-pro-preview-thinking",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "AI æ™ºèƒ½è’¸é¦ (Gemini)",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "MCP Client": {
      "main": [
        [
          {
            "node": "MCP Client1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "main": [
        [
          {
            "node": "æ¸…æ´—é›·é€Ÿåˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åŒ¹é…çƒé˜Ÿ": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¸…æ´—é›·é€Ÿåˆ—è¡¨": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "main": [
        [
          {
            "node": "MCP Client3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client3": {
      "main": [
        [
          {
            "node": "JavaScript å…³é”®è¯è„±æ°´",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JavaScript å…³é”®è¯è„±æ°´": {
      "main": [
        [
          {
            "node": "AI æ™ºèƒ½è’¸é¦ (Gemini)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "MCP Client2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è·å–æ¯”èµ›è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "PostgreSQL(Fetch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostgreSQL(Fetch)": {
      "main": [
        [
          {
            "node": "PostgreSQL(Locking)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostgreSQL(Locking)": {
      "main": [
        [
          {
            "node": "MCP Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI å¯¹é½è£åˆ¤",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI å¯¹é½è£åˆ¤",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "AI å¯¹é½è£åˆ¤": {
      "main": [
        [
          {
            "node": "åŒ¹é…çƒé˜Ÿ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client4": {
      "main": [
        [
          {
            "node": "Firecrawl_Extract",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Firecrawl_Extract": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Get AI Memory",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "timezone": "Asia/Shanghai",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "triggerCount": 1,
  "versionId": "43c451ac-eaf0-4ebf-855d-faa08418be44",
  "owner": {
    "type": "personal",
    "projectId": "4gZXsoo5v3SNQN13",
    "projectName": "å·æ¢¦ ä¹¦ <3424771506@qq.com>",
    "personalEmail": "3424771506@qq.com"
  },
  "parentFolderId": null,
  "isArchived": false
}