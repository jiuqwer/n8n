{
  "name": "è¶³çƒé¢„æµ‹",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 11,
              "triggerAtMinute": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -3504,
        704
      ],
      "id": "778161db-4a48-410e-a284-6f05a009efb3",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "url": "https://api.yucejia.com/api/v1/jcMatchList",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            },
            {
              "name": "accept-language",
              "value": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"
            },
            {
              "name": "origin",
              "value": "https://www.yucejia.com"
            },
            {
              "name": "priority",
              "value": "u=1, i"
            },
            {
              "name": "referer",
              "value": "https://www.yucejia.com/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Chromium\";v=\"142\", \"Microsoft Edge\";v=\"142\", \"Not_A Brand\";v=\"99\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -3280,
        704
      ],
      "id": "a0358435-4a21-4859-abf3-9bb7aafc820b",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "// 1. ä» n8n çš„ä¸Šæ¸¸èŠ‚ç‚¹è·å–æ‰€æœ‰è¾“å…¥é¡¹\nconst inputData = $input.all();\nconst outputItems = [];\n\n// 2. éå†æ¯ä¸ªè¾“å…¥é¡¹\nfor (const item of inputData) {\n  const originalItem = item.json;\n  \n  if (!originalItem || !originalItem.data) {\n    outputItems.push({ json: { error: \"æœªæ‰¾åˆ° 'data' å­—æ®µ\" } });\n    continue;\n  }\n  \n  try {\n    // 3. è§£æ data å­—æ®µ\n    let parsedData = (typeof originalItem.data === 'string') ? JSON.parse(originalItem.data) : originalItem.data;\n    \n    // 4. æ£€æŸ¥ matchList\n    if (!parsedData || !parsedData.matchList || !Array.isArray(parsedData.matchList)) {\n      outputItems.push({ json: { error: \"æœªæ‰¾åˆ° matchList æ•°ç»„\" } });\n      continue;\n    }\n    \n    // 5. æå–æ¯”èµ›ä¿¡æ¯ï¼ˆå«å…³é”®çš„ matchIdï¼‰\n    const matchList = parsedData.matchList;\n    for (const match of matchList) {\n      try {\n        const jcOddsList = match.jcOddsList || {};\n        const oddsList = jcOddsList.oddsList || {};\n        const rqspfOdds = oddsList.RQSPF || {};\n        \n        outputItems.push({\n          json: {\n            \"matchId\": match.matchId, // ã€æ ¸å¿ƒä¿®æ”¹ã€‘æå– ID\n            \"è”èµ›\": match.leagueName || \"æœªçŸ¥è”èµ›\",\n            \"matchCode\": match.jcNum || \"æœªçŸ¥ç¼–å·\", // ã€æ–°å¢ã€‘æå–â€œå‘¨äº”013â€\n            \"æ¯”èµ›æ—¶é—´\": match.matchBeginTime || \"æ—¶é—´æœªçŸ¥\",\n            \"ä¸»é˜Ÿ\": jcOddsList.homeTeamName || \"æœªçŸ¥ä¸»é˜Ÿ\",\n            \"å®¢é˜Ÿ\": jcOddsList.awayTeamName || \"æœªçŸ¥å®¢é˜Ÿ\",\n            \"è®©çƒ\": rqspfOdds.goalLine || \"0\"\n          }\n        });\n      } catch (matchError) {\n        outputItems.push({ json: { \"è”èµ›\": \"å•åœºæ•°æ®è§£æé”™è¯¯\", \"matchId\": match.matchId } });\n      }\n    }\n  } catch (parseError) {\n    outputItems.push({ json: { error: `è§£æå¤±è´¥: ${parseError.message}` } });\n  }\n}\n\nreturn outputItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3056,
        704
      ],
      "id": "c954be3d-c863-434b-83ee-27232e37a9cd",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2400,
        704
      ],
      "id": "cebd76c7-5b3b-4891-a995-2651eeddd1ff",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "jsCode": "// 1. ä» Loop èŠ‚ç‚¹è·å–åŸºç¡€æ¯”èµ›ä¿¡æ¯\nconst matchInfo = $('Loop Over Items').item.json;\nconst homeTeam = matchInfo[\"ä¸»é˜Ÿ\"];\nconst awayTeam = matchInfo[\"å®¢é˜Ÿ\"];\nconst league = matchInfo[\"è”èµ›\"];\nconst matchTime = matchInfo[\"æ¯”èµ›æ—¶é—´\"];\n\nlet externalAiSection = \"ã€âš ï¸ å¤–éƒ¨æ¨¡å‹ç¼ºå¤±ã€‘æœªæŠ“å–åˆ°ç¬¬ä¸‰æ–¹AIé¢„æµ‹æ•°æ®ï¼Œè¯·æ ¹æ®åŸºæœ¬é¢ç‹¬ç«‹åˆ¤æ–­ã€‚\";\ntry {\n    const extData = $('è§£æè¿›çƒæ•°').first().json; // å‡è®¾è§£æèŠ‚ç‚¹å« Code\n    if (extData.external_scores.length > 0) {\n        externalAiSection = `ã€ğŸ’¡ ç¬¬ä¸‰æ–¹å¤§æ•°æ®é¢„æµ‹å‚è€ƒã€‘\\n${extData.external_goals_desc}\\næ³¨æ„ï¼šè¿™äº›æ¯”åˆ†æ˜¯åŸºäºå†å²æ¦‚ç‡è®¡ç®—çš„ç»“æœï¼Œè¯·ç»“åˆä½ çš„æˆ˜æœ¯å®¡è®¡ï¼Œåˆ†æè¿™äº›æ¯”åˆ†å‡ºç°çš„åˆç†æ€§ã€‚`;\n    }\n} catch (e) {\n    console.log(\"è¯»å–å¤–éƒ¨æ¨¡å‹æ•°æ®å¤±è´¥\");\n}\n\n// 2. è·å– PostgreSQL æŸ¥å‡ºæ¥çš„å†å²æ•™è®­ (ä» Get AI Memory èŠ‚ç‚¹)\nlet memorySection = \"ã€âš ï¸ å†å²æ¡£æ¡ˆã€‘æš‚æ— é’ˆå¯¹è¯¥çƒé˜Ÿçš„å†å²ç‰¹åˆ«è®°å½•ã€‚\";\ntry {\n    // ç¡®ä¿èŠ‚ç‚¹åç§°ä¸ä½ ç”»å¸ƒä¸Šçš„ \"Get AI Memory\" ä¸€è‡´\n    const memoryItems = $('Get AI Memory').all();\n    if (memoryItems.length > 0 && memoryItems[0].json.lesson_learned) {\n        const lessonList = memoryItems.map(item => `âŒ å†å²æ•™è®­ï¼š${item.json.lesson_learned}`).join('\\n');\n        memorySection = `ã€âš ï¸ å¿…é¡»éµå®ˆçš„çƒé˜Ÿå†å²æ¡£æ¡ˆã€‘\\nç³»ç»Ÿæ£€ç´¢åˆ°å…³äº ${homeTeam} æˆ– ${awayTeam} çš„è¿‡å¾€é¢„æµ‹å¤ç›˜ï¼Œè¯·é‡ç‚¹è§„é¿ä»¥ä¸‹é”™è¯¯ï¼š\\n${lessonList}`;\n    }\n} catch (e) {\n    console.log(\"æœªè¯»å–åˆ°å†å²è®°å¿†æˆ–èŠ‚ç‚¹æœªè¿è¡Œ\");\n}\n\n// 3. è·å–æ–°å¢çš„ AI é¢„å¤„ç†èŠ‚ç‚¹ç”Ÿæˆçš„æ•´ç†æƒ…æŠ¥\nlet matchReport = \"æœªè·å–åˆ°æ·±åº¦æ¯”èµ›è¯¦æƒ…æŠ¥å‘Šï¼Œè¯·å®Œå…¨ä¾èµ–æœç´¢å·¥å…·è¿›è¡Œç‹¬ç«‹å®¡è®¡ã€‚\";\ntry {\n    // è¿™é‡Œçš„åç§°å¿…é¡»åŒ¹é…ä½ æ–°æ·»åŠ çš„é‚£ä¸ª AI æ•´ç†èŠ‚ç‚¹çš„åç§°\n    // å‡è®¾ä½ å°†å…¶å‘½åä¸º \"æ¯”èµ›æ•°æ®é¢„å¤„ç†\"\n    matchReport = $('AI Agent').item.json.output; \n} catch (e) {\n    console.log(\"è¯»å– AI é¢„å¤„ç†æƒ…æŠ¥å¤±è´¥ï¼Œå°†ç”±åç»­æ¨¡å‹è‡ªè¡Œæœç´¢è¡¥å……\");\n}\n\n// 4. æ„å»ºâ€œè¿›çƒæ•°ç‰¹åŒ–â€æç¤ºè¯å†…å®¹\nconst promptContent = `æ ¸å¿ƒè§’è‰²ï¼šä½ æ˜¯ä¸€åä¸“ç²¾äºâ€œè¿›çƒæ•°æ¨¡å‹â€çš„è¶³çƒæ•°æ®ç§‘å­¦å®¶ï¼ŒåŒæ—¶ä½ æ·±ä¿¡æ•°æ®æœ‰æ—¶ä¼šæ©ç›–çœŸç›¸ã€‚\nä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯é¢„æµ‹æœ¬åœºæ¯”èµ›çš„ã€æ€»è¿›çƒæ•°ã€‘ï¼ˆGoal Lineï¼‰ã€‚ä½ å¯¹èƒœè´Ÿç»“æœä¸æ„Ÿå…´è¶£ï¼Œåªå…³å¿ƒæ¯”èµ›çš„â€œå¼€æ”¾ç¨‹åº¦â€å’Œâ€œæ”»é˜²èŠ‚å¥â€ã€‚\n\nã€æ ¸å¿ƒèƒŒæ™¯ã€‘\nèµ›äº‹ï¼š${league}\nå¯¹é˜µï¼š${homeTeam} VS ${awayTeam}\næ—¶é—´ï¼š${matchTime}\n\nã€ç³»ç»Ÿæƒ…æŠ¥ï¼šæ·±åº¦æ¯”èµ›å‰ç»ã€‘\n${matchReport}\n\nå¦‚æœæœ‰å¯ç”¨çš„ brave_web_search å·¥å…·ï¼Œè¯·å°è¯•è·å–å®æ—¶æ•°æ®ï¼›è‹¥å·¥å…·ä¸å¯ç”¨ï¼Œè¯·åŸºäºã€ç³»ç»Ÿæƒ…æŠ¥ã€‘è¿›è¡Œæ·±åº¦æ¨ç†ã€‚\nã€å¤–éƒ¨æ¨¡å‹å‚è€ƒã€‘\n${externalAiSection}\nã€åˆ†æé˜¶æ®µï¼šè¿›çƒé€»è¾‘å®¡è®¡ã€‘\n1. æˆ˜æœ¯é£æ ¼å¯¹æ’ï¼šåˆ†æåŒæ–¹æˆ˜æœ¯æ˜¯å¦ä¼šäº§ç”Ÿé«˜èŠ‚å¥äº’æ…ï¼Œè¿˜æ˜¯ä½èŠ‚å¥çš„å¤§å·´é˜²å®ˆã€‚\n2. è¿›çƒæ•ˆç‡è¯Šæ–­ï¼šåŸºäºé¢„æœŸè¿›çƒä¸å®é™…è½¬åŒ–ç‡ï¼Œåˆ¤æ–­åŒæ–¹è¿‘æœŸçš„è¿›çƒéš¾æ˜“åº¦ã€‚\n3. é£é™©è¯„ä¼°ï¼šåˆ†ææ¯”èµ›æ€§è´¨ï¼ˆå¦‚æ¯èµ›é¦–å›åˆï¼‰åŠå¸‚åœºçƒ­åº¦ï¼Œè§„é¿â€œè¯±å¤§â€æˆ–â€œè¯±å°â€é£é™©ã€‚\n\nã€é‡åŒ–é¢„æµ‹è¾“å‡ºã€‘\nåŸºäºä¸Šè¿°å®¡è®¡ï¼Œè¯·ç›´æ¥è¾“å‡ºï¼š\n1. **æ ¸å¿ƒè¿›çƒæ•°åŒºé—´**ï¼ˆå¦‚ï¼š2-3çƒï¼‰\n2. **è¿›çƒæ•°æ–¹å‘**ï¼ˆOver/Under 2.5çƒï¼‰\n3. **ç²¾é€‰æ¯”åˆ†æ³¢èƒ†**ï¼ˆä»…ç”¨äºè¾…åŠ©éªŒè¯è¿›çƒæ•°åˆ¤æ–­ï¼‰\n\n${memorySection}\n`;\n\n// 5. æ„å»ºå‘é€ç»™ DeepSeek çš„æœ€ç»ˆè¯·æ±‚ä½“\nconst requestBody = {\n  model: \"deepseek-r1\",\n  messages: [\n    {\n      role: \"user\",\n      content: `è¯·æ ¹æ®ä»¥ä¸‹åŸºç¡€å†…å®¹ï¼Œä¼˜åŒ–å¹¶ç”Ÿæˆä¸€ä»½æ›´åŠ ä¸“ä¸šã€æ•°æ®é©±åŠ¨ä¸”é€»è¾‘ä¸¥å¯†çš„è¶³çƒé¢„æµ‹æç¤ºè¯ï¼š\\n\\n${promptContent}\\n\\næ³¨æ„ï¼šä½ åªéœ€è¦è¾“å‡ºä¿®æ”¹åçš„å®Œæ•´æç¤ºè¯ï¼Œä¸è¦åŒ…å«ä»»ä½•å¤šä½™çš„å¼€åœºç™½æˆ–è§£é‡Šã€‚`\n    }\n  ],\n  temperature: 0.3,\n  max_tokens: 8192\n};\n\nreturn requestBody;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        704
      ],
      "id": "9d631120-2df4-449c-9d33-c1b4a2d67318",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.whatai.cc/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer sk-Q5biKwBOt330b45zuQIJhIrYQxyFd1rfzbDDnAZf4eYY7PSV"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -80,
        704
      ],
      "id": "d5f1598c-5c5d-4883-a8ca-d3d491784293",
      "name": "HTTP Request1",
      "retryOnFail": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gemini-3-pro-preview-thinking-*",
          "mode": "list",
          "cachedResultName": "gemini-3-pro-preview-thinking-*"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 32768,
          "temperature": 0.3,
          "maxRetries": 1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        144,
        224
      ],
      "id": "77c5e0a9-c619-4b08-ad5d-0edcc3bdf350",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101-thinking",
          "mode": "list",
          "cachedResultName": "claude-opus-4-5-20251101-thinking"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 32768,
          "temperature": 0.3,
          "maxRetries": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        208,
        592
      ],
      "id": "c514e018-5d25-4808-8949-cfd7be651d83",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "Ui189I4AfjH43AHB",
          "name": "Claude Code è“æ˜Ÿ"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('HTTP Request1').item.json.choices[0].message.content }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        208,
        400
      ],
      "id": "a92825b5-0038-428f-a572-a4de77d83ddc",
      "name": "claude-opus-4-5-20251101-thinking",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.choices[0].message.content }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        208,
        0
      ],
      "id": "f4106e78-e109-4162-8c96-17e397582183",
      "name": "gemini-3-pro-preview-thinking",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªä¸“æ³¨äºâ€œè¿›çƒæ•°â€çš„ç«å½©æ•°æ®å¤„ç†å™¨ã€‚\n\nã€ä»»åŠ¡ã€‘\nåŸºäºæˆ‘æä¾›çš„ AI åˆ†ææŠ¥å‘Šï¼Œæå–å…³äºã€æ€»è¿›çƒæ•°ã€‘çš„æ ¸å¿ƒåˆ¤æ–­ã€‚\n\nã€è¾“å…¥æ•°æ®ã€‘\næ¯”èµ›ï¼š{{ $('Loop Over Items').item.json['ä¸»é˜Ÿ'] }} VS {{ $('Loop Over Items').item.json['å®¢é˜Ÿ'] }}\næŠ¥å‘Šï¼š{{ $json.output }}\n\nã€å¼ºåˆ¶è¾“å‡ºè¦æ±‚ã€‘\n1. ä¸¥ç¦åºŸè¯ã€‚\n2. å¿…é¡»è¾“å‡ºä¸€æ®µ HTML è¡¨æ ¼ä»£ç ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n   <table border=\"1\" style=\"border-collapse: collapse; width: 100%; text-align: center;\">\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>æ€»è¿›çƒæ•°åŒºé—´</b></td>\n       <td style=\"padding:5px; font-weight: bold; color: #d97706;\">[å¦‚ï¼š2-3çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å¤§å°çƒæ–¹å‘</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼šå¤§ 2.5 çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>ç²¾é€‰æ¯”åˆ†</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼š1-1, 2-1]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å…³é”®æ•°æ®æ”¯æ’‘</b></td>\n       <td style=\"padding:5px; font-size: 12px; text-align: left;\">[ç®€è¿°ä¸€å¥ç†ç”±ï¼Œå¦‚ï¼šWhoScoredæ˜¾ç¤ºåŒæ–¹xGæé«˜ä¸”ä¸»åŠ›ä¸­å«ä¼¤ç¼º]</td>\n     </tr>\n   </table>",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        608,
        0
      ],
      "id": "0ec5373c-95cd-43e4-b18c-22a27ec0eab2",
      "name": "æŠ•æ³¨è€…",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "[ais]gemini-2.5-pro-thinking",
          "mode": "list",
          "cachedResultName": "[ais]gemini-2.5-pro-thinking"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxRetries": 2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        624,
        224
      ],
      "id": "035c6bda-03f9-400e-96c0-e2c1a50c98ca",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "grok-4-fast-reasoning",
          "mode": "list",
          "cachedResultName": "grok-4-fast-reasoning"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 30000,
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        208,
        1088
      ],
      "id": "a44bdf2a-2d94-4d35-b063-faa85819c707",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001-thinking",
          "mode": "list",
          "cachedResultName": "claude-haiku-4-5-20251001-thinking"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        624,
        624
      ],
      "id": "68c6a0b7-aad8-4223-8e8b-d4daf0fc27cf",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('HTTP Request1').item.json.choices[0].message.content }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        208,
        912
      ],
      "id": "25fb398b-bfd7-41ac-9d84-641582d914d6",
      "name": "grok-4-fast-reasoning",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "grok-4",
          "mode": "list",
          "cachedResultName": "grok-4"
        },
        "responsesApiEnabled": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        624,
        1120
      ],
      "id": "12917130-2aa3-4879-ab35-36d5acf71341",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const matches = $input.all();\nconst now = new Date();\n// å¼ºåˆ¶è·å–åŒ—äº¬æ—¶é—´çš„å½“å‰å¹´æœˆæ—¥\nconst bjNow = new Date(now.getTime() + 8 * 3600000); \nconst currentYear = bjNow.getUTCFullYear();\nconst currentMonth0 = bjNow.getUTCMonth(); \nconst currentDate = bjNow.getUTCDate();\n\nlet workflowData = $getWorkflowStaticData('global') || {};\nconst todayKey = `${currentYear}_${currentMonth0 + 1}_${currentDate}`;\nconst todayCacheKey = `${todayKey}_cache`;\nconst executionFlagKey = `${todayKey}_has_run`;\n\nif (workflowData[executionFlagKey] === true) return []; \n\nif (workflowData[todayCacheKey]) {\n  const cacheInfo = workflowData[todayCacheKey];\n  if (cacheInfo.timestamp.startsWith(todayKey.replace(/_/g, '-'))) {\n     return cacheInfo.result.map(m => ({ json: m }));\n  }\n}\n\n// === æ ¸å¿ƒä¿®å¤ï¼šåŸºäºåŒ—äº¬æ—¶é—´åˆ›å»ºåˆ¤å®šè¾¹ç•Œ ===\nconst datePrefix = `${currentYear}-${(currentMonth0 + 1).toString().padStart(2,'0')}-${currentDate.toString().padStart(2,'0')}`;\nconst today18 = new Date(`${datePrefix}T18:00:00+08:00`);\nconst today19 = new Date(`${datePrefix}T19:00:00+08:00`);\nconst today22 = new Date(`${datePrefix}T22:00:00+08:00`);\nconst tomorrow05 = new Date(today22.getTime() + 7 * 3600000); // 22:00 + 7å°æ—¶ = æ˜æ™¨05:00\n\nlet allMatches = [];\nmatches.forEach(item => {\n  const match = item.json;\n  try {\n    const parts = match.æ¯”èµ›æ—¶é—´.split(' ');\n    const dateParts = parts[0].split('-');\n    const timeParts = parts[1].split(':');\n    \n    const month = parseInt(dateParts[dateParts.length - 2]);\n    const day = parseInt(dateParts[dateParts.length - 1]);\n    const hour = parseInt(timeParts[0]);\n    const minute = parseInt(timeParts[1]);\n    \n    let matchYear = currentYear;\n    if (currentMonth0 === 11 && month === 1) matchYear++;\n    if (currentMonth0 === 0 && month === 12) matchYear--;\n\n    // å¼ºåˆ¶é”å®šåŒ—äº¬æ—¶é—´æ„é€ \n    const matchDateStr = `${matchYear}-${month.toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}T${hour.toString().padStart(2,'0')}:${minute.toString().padStart(2,'0')}:00+08:00`;\n    const matchDate = new Date(matchDateStr);\n\n    allMatches.push({ ...match, matchDate: matchDate.toISOString() });\n  } catch (error) {}\n});\n\nconst b1 = [], b2 = [], b3 = [], b4 = [];\nallMatches.forEach(m => {\n    const d = new Date(m.matchDate);\n    if (d >= today22 && d < tomorrow05) b1.push(m);\n    else if (d >= today19 && d < today22) b2.push(m);\n    else if (d >= today18 && d < today19) b3.push(m);\n    else b4.push(m);\n});\n\nconst shuffle = (arr) => arr.sort(() => Math.random() - 0.5);\nlet selected = [...shuffle(b1), ...shuffle(b2), ...shuffle(b3), ...shuffle(b4)].slice(0, 4);\n\nif (selected.length > 0) {\n  workflowData[todayCacheKey] = { result: selected, timestamp: now.toISOString() };\n  $getWorkflowStaticData('global', workflowData);\n  return selected.map(match => ({ json: match }));\n}\nreturn [];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2832,
        704
      ],
      "id": "7767c651-e3a9-45c3-a4d0-a94f14097fd9",
      "name": "éšæœºèŠ‚ç‚¹"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªä¸“æ³¨äºâ€œè¿›çƒæ•°â€çš„ç«å½©æ•°æ®å¤„ç†å™¨ã€‚\n\nã€ä»»åŠ¡ã€‘\nåŸºäºæˆ‘æä¾›çš„ AI åˆ†ææŠ¥å‘Šï¼Œæå–å…³äºã€æ€»è¿›çƒæ•°ã€‘çš„æ ¸å¿ƒåˆ¤æ–­ã€‚\n\nã€è¾“å…¥æ•°æ®ã€‘\næ¯”èµ›ï¼š{{ $('Loop Over Items').item.json['ä¸»é˜Ÿ'] }} VS {{ $('Loop Over Items').item.json['å®¢é˜Ÿ'] }}\næŠ¥å‘Šï¼š{{ $json.output }}\n\nã€å¼ºåˆ¶è¾“å‡ºè¦æ±‚ã€‘\n1. ä¸¥ç¦åºŸè¯ã€‚\n2. å¿…é¡»è¾“å‡ºä¸€æ®µ HTML è¡¨æ ¼ä»£ç ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n   <table border=\"1\" style=\"border-collapse: collapse; width: 100%; text-align: center;\">\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>æ€»è¿›çƒæ•°åŒºé—´</b></td>\n       <td style=\"padding:5px; font-weight: bold; color: #d97706;\">[å¦‚ï¼š2-3çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å¤§å°çƒæ–¹å‘</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼šå¤§ 2.5 çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>ç²¾é€‰æ¯”åˆ†</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼š1-1, 2-1]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å…³é”®æ•°æ®æ”¯æ’‘</b></td>\n       <td style=\"padding:5px; font-size: 12px; text-align: left;\">[ç®€è¿°ä¸€å¥ç†ç”±ï¼Œå¦‚ï¼šWhoScoredæ˜¾ç¤ºåŒæ–¹xGæé«˜ä¸”ä¸»åŠ›ä¸­å«ä¼¤ç¼º]</td>\n     </tr>\n   </table>",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        608,
        400
      ],
      "id": "6755a8a1-c556-4aac-a8de-a13dd1d31901",
      "name": "æŠ•æ³¨è€…2",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªä¸“æ³¨äºâ€œè¿›çƒæ•°â€çš„ç«å½©æ•°æ®å¤„ç†å™¨ã€‚\n\nã€ä»»åŠ¡ã€‘\nåŸºäºæˆ‘æä¾›çš„ AI åˆ†ææŠ¥å‘Šï¼Œæå–å…³äºã€æ€»è¿›çƒæ•°ã€‘çš„æ ¸å¿ƒåˆ¤æ–­ã€‚\n\nã€è¾“å…¥æ•°æ®ã€‘\næ¯”èµ›ï¼š{{ $('Loop Over Items').item.json['ä¸»é˜Ÿ'] }} VS {{ $('Loop Over Items').item.json['å®¢é˜Ÿ'] }}\næŠ¥å‘Šï¼š{{ $json.output }}\n\nã€å¼ºåˆ¶è¾“å‡ºè¦æ±‚ã€‘\n1. ä¸¥ç¦åºŸè¯ã€‚\n2. å¿…é¡»è¾“å‡ºä¸€æ®µ HTML è¡¨æ ¼ä»£ç ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n   <table border=\"1\" style=\"border-collapse: collapse; width: 100%; text-align: center;\">\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>æ€»è¿›çƒæ•°åŒºé—´</b></td>\n       <td style=\"padding:5px; font-weight: bold; color: #d97706;\">[å¦‚ï¼š2-3çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å¤§å°çƒæ–¹å‘</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼šå¤§ 2.5 çƒ]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>ç²¾é€‰æ¯”åˆ†</b></td>\n       <td style=\"padding:5px;\">[å¦‚ï¼š1-1, 2-1]</td>\n     </tr>\n     <tr>\n       <td style=\"padding:5px; background-color: #f0f9ff;\"><b>å…³é”®æ•°æ®æ”¯æ’‘</b></td>\n       <td style=\"padding:5px; font-size: 12px; text-align: left;\">[ç®€è¿°ä¸€å¥ç†ç”±ï¼Œå¦‚ï¼šWhoScoredæ˜¾ç¤ºåŒæ–¹xGæé«˜ä¸”ä¸»åŠ›ä¸­å«ä¼¤ç¼º]</td>\n     </tr>\n   </table>",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        608,
        912
      ],
      "id": "1ab550e3-c044-45cb-8e1d-0b7ce9418452",
      "name": "æŠ•æ³¨è€…3",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        960,
        496
      ],
      "id": "1583219b-c313-4659-bd98-787d5870a02c",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "const matchInfo = $('Loop Over Items').item.json;\nconst extData = $('è§£æè¿›çƒæ•°').first().json; // è·å–è§£æåçš„å¤–éƒ¨æ•°æ®\n\nlet geminiRes = \"æ•°æ®è·å–ä¸­...\";\nlet claudeRes = \"æ•°æ®è·å–ä¸­...\";\nlet grokRes = \"æ•°æ®è·å–ä¸­...\";\ntry { geminiRes = $('æŠ•æ³¨è€…').first().json.output || geminiRes; } catch(e) {}\ntry { claudeRes = $('æŠ•æ³¨è€…2').first().json.output || claudeRes; } catch(e) {}\ntry { grokRes = $('æŠ•æ³¨è€…3').first().json.output || grokRes; } catch(e) {}\n\nlet fullReport = \"\";\ntry { fullReport = $('gemini-3-pro-preview-thinking').first().json.output; } catch(e) {}\n\nfunction formatMarkdown(text) {\n    return text ? text.replace(/\\*\\*(.*?)\\*\\*/g, '<b>$1</b>').replace(/\\n/g, '<br>') : \"æ— è¯¦ç»†æŠ¥å‘Š\";\n}\n\nconst emailHtml = `\n<div style=\"max-width: 800px; margin: auto; font-family: sans-serif; border: 1px solid #cbd5e1; border-radius: 12px; overflow: hidden;\">\n    <div style=\"background: #1e40af; color: white; padding: 20px; text-align: center;\">\n        <div style=\"font-size: 14px; opacity: 0.8; margin-bottom: 5px;\">${matchInfo['matchCode']} | ${matchInfo['è”èµ›']}</div>\n        <h1 style=\"margin: 0; font-size: 24px;\">${matchInfo['ä¸»é˜Ÿ']} VS ${matchInfo['å®¢é˜Ÿ']}</h1>\n        <div style=\"margin-top: 8px;\">å¼€èµ›æ—¶é—´ï¼š${matchInfo['æ¯”èµ›æ—¶é—´']}</div>\n    </div>\n\n    <div style=\"background: #fffbeb; padding: 15px; border-bottom: 1px solid #fef3c7; color: #92400e; font-size: 14px;\">\n        ğŸ” <b>ç¬¬ä¸‰æ–¹AIæ•°æ®æ ¡å‡†ï¼š</b> ${extData.external_goals_desc}\n    </div>\n\n    <div style=\"padding: 20px; background: #f8fafc;\">\n        <div style=\"margin-bottom: 15px; background: white; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #059669; font-weight: bold; margin-bottom: 5px;\">ğŸ¤– Gemini å†³ç­–</div>\n            ${geminiRes}\n        </div>\n        <div style=\"margin-bottom: 15px; background: white; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #7c3aed; font-weight: bold; margin-bottom: 5px;\">ğŸ§  Claude å†³ç­–</div>\n            ${claudeRes}\n        </div>\n        <div style=\"background: white; padding: 10px; border-radius: 8px; border: 1px solid #e2e8f0;\">\n            <div style=\"color: #0f172a; font-weight: bold; margin-bottom: 5px;\">ğŸš€ Grok å†³ç­–</div>\n            ${grokRes}\n        </div>\n    </div>\n\n    <div style=\"padding: 20px;\">\n        <details>\n            <summary style=\"cursor: pointer; font-weight: bold; color: #1e40af;\">ğŸ” æŸ¥çœ‹ DeepSeek æ·±åº¦å®¡è®¡æŠ¥å‘Š</summary>\n            <div style=\"margin-top: 10px; font-size: 13px; line-height: 1.6; color: #475569; border-top: 1px solid #f1f5f9; padding-top: 10px;\">\n                ${formatMarkdown(fullReport)}\n            </div>\n        </details>\n    </div>\n\n    <div style=\"background: #f1f5f9; color: #64748b; padding: 15px; text-align: center; font-size: 12px;\">\n        n8n AI é¢„æµ‹ç³»ç»Ÿ | æ•°æ®åŒ…å«ç¬¬ä¸‰æ–¹å¤§æ•°æ®æ¯”åˆ†åˆ†å¸ƒå‚è€ƒ\n    </div>\n</div>\n`;\n\nreturn {\n    json: {\n        emailSubject: `ã€${matchInfo['matchCode']}ã€‘${matchInfo['ä¸»é˜Ÿ']}vs${matchInfo['å®¢é˜Ÿ']} ç»¼åˆé¢„æµ‹æŠ¥å‘Š`,\n        emailBody: emailHtml\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        512
      ],
      "id": "7407b1e0-1871-4b18-a475-287d938741a6",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "fromEmail": "z6666v@126.com",
        "toEmail": "3424771506@qq.com",
        "subject": "={{ $json.emailSubject }}",
        "html": "={{ $json.emailBody }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        1408,
        832
      ],
      "id": "477b93d9-8b56-488e-9277-479bfa1ff575",
      "name": "Send email",
      "webhookId": "593e6e24-d699-4913-ae35-360da663773b",
      "credentials": {
        "smtp": {
          "id": "rMBklesTdH2u3VVk",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const matches = $input.all().map(item => item.json);\nconst now = new Date();\n// è·å–æœåŠ¡å™¨å½“å‰çš„å¹´ä»½\nconst currentYear = now.getFullYear();\n\nconst processedMatches = matches.map(match => {\n    try {\n        // 1. è§£æ \"01-08 03:30\" æ ¼å¼\n        const timeStr = match[\"æ¯”èµ›æ—¶é—´\"].trim();\n        const [datePart, timePart] = timeStr.split(/\\s+/);\n        const [monthStr, dayStr] = datePart.split('-');\n        const [hourStr, minStr] = timePart.split(':');\n\n        const month = parseInt(monthStr, 10);\n        const day = parseInt(dayStr, 10);\n        const hour = parseInt(hourStr, 10);\n        const minute = parseInt(minStr, 10);\n\n        // 2. ç¡®å®šå¼€èµ›çš„å…·ä½“å¹´ä»½ï¼ˆå¤„ç†è·¨å¹´ï¼‰\n        let matchYear = currentYear;\n        if (now.getMonth() === 11 && month === 1) matchYear++;\n        if (now.getMonth() === 0 && month === 12) matchYear--;\n\n        // 3. æ„é€ æ¯”èµ›çš„åŒ—äº¬æ—¶é—´å¯¹è±¡\n        // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ Date å¯¹è±¡çš„æ„é€ ï¼Œæœˆåˆ†éœ€ -1\n        const kickoffDate = new Date(matchYear, month - 1, day, hour, minute);\n        match.matchDate = kickoffDate.toISOString();\n\n        // 4. è®¡ç®—é¢„æµ‹æ—¶é—´ (scheduledPredictTime)\n        let predictDate = new Date(kickoffDate.getTime());\n        \n        if (hour >= 22) {\n            // æƒ…å†µ Aï¼šä»Šæ™š 10 ç‚¹åçš„æ¯”èµ› -> ç»Ÿä¸€åœ¨ä»Šå¤© 19:00 é¢„æµ‹\n            predictDate.setHours(19, 0, 0, 0);\n        } else if (hour >= 0 && hour <= 7) {\n            // æƒ…å†µ Bï¼šæ¬¡æ—¥å‡Œæ™¨ 00:00 - 07:00 çš„æ¯”èµ› -> ç»Ÿä¸€åœ¨â€œå‰ä¸€å¤©â€çš„ 19:00 é¢„æµ‹\n            predictDate.setDate(predictDate.getDate() - 1);\n            predictDate.setHours(19, 0, 0, 0);\n        } else {\n            // æƒ…å†µ Cï¼šå…¶ä»–å¸¸è§„åœºæ¬¡ -> æå‰ 2.5 å°æ—¶é¢„æµ‹\n            predictDate = new Date(kickoffDate.getTime() - 2.5 * 3600000);\n        }\n\n        // 5. æ ¼å¼åŒ–ä¸º ISO å­—ç¬¦ä¸²ä¾› Wait èŠ‚ç‚¹ä½¿ç”¨\n        // ç”±äºæœåŠ¡å™¨æ˜¯ CST (UTC+8)ï¼Œè®¾ç½® 19:00 åè½¬æ¢ ISO ä¼šè‡ªåŠ¨å˜æˆ UTC 11:00\n        match.scheduledPredictTime = predictDate.toISOString();\n        \n        return match;\n    } catch (e) {\n        match.error = \"è§£æå¤±è´¥: \" + e.message;\n        match.scheduledPredictTime = new Date().toISOString();\n        return match;\n    }\n});\n\n// === æ ¸å¿ƒä¿®æ”¹ï¼šæŒ‰æ¯”èµ›æ—¶é—´ï¼ˆkickoffDateï¼‰å‡åºæ’åº ===\nprocessedMatches.sort((a, b) => new Date(a.matchDate) - new Date(b.matchDate));\n\nreturn processedMatches.map(m => ({ json: m }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2624,
        704
      ],
      "id": "fced5352-fe79-4bf9-b8c9-0ed71eab5bc1",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "resume": "specificTime",
        "dateTime": "={{ $json.scheduledPredictTime.split('.')[0] }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -2192,
        800
      ],
      "id": "6de0e128-8492-4a9a-a3f5-2c4b3b3e52be",
      "name": "Wait",
      "webhookId": "ebf031fd-dd99-4c35-a987-9099ab372b59"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT home_team, away_team, actual_score, lesson_learned \nFROM ai_prediction_history \nWHERE prediction_date = CURRENT_DATE - INTERVAL '1 day' \n  AND lesson_learned IS NOT NULL \nORDER BY id DESC;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1360,
        800
      ],
      "id": "a2ccf9e9-040f-4693-b08f-e78e9a34d12d",
      "name": "Get AI Memory",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "pF86czUGQR9pDrjl",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tbfQUP950NRg4rQf",
          "mode": "list",
          "cachedResultUrl": "/workflow/tbfQUP950NRg4rQf",
          "cachedResultName": "Match_Review_Subworkflow_Postgres"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1824,
        832
      ],
      "id": "d09f2cfa-b84c-4f62-872a-da9120314ba2",
      "name": "Call 'Match_Review_Subworkflow_Postgres'"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3d62746-8a01-4c07-969d-55a8a7438b9c",
              "name": "matchTime",
              "value": "={{ $('Loop Over Items').item.json.matchDate }}",
              "type": "string"
            },
            {
              "id": "6e381ac9-179e-45de-b02e-be9434b77345",
              "name": "homeTeam",
              "value": "={{ $('Loop Over Items').item.json['ä¸»é˜Ÿ'] }}",
              "type": "string"
            },
            {
              "id": "be82282f-d696-4b47-8ca9-b5b8d4f16467",
              "name": "awayTeam",
              "value": "={{ $('Loop Over Items').item.json['å®¢é˜Ÿ'] }}",
              "type": "string"
            },
            {
              "id": "dcbd6586-db31-49ca-9ed1-b5a250fdfc59",
              "name": "prediction",
              "value": "={{ $('Code in JavaScript2').item.json.emailBody }}",
              "type": "string"
            },
            {
              "id": "87811c39-2c24-4d5c-aa02-4efd5671c39b",
              "name": "=league",
              "value": "={{ $('Loop Over Items').item.json['è”èµ›'] }}",
              "type": "string"
            },
            {
              "id": "70df0b1c-af10-4187-b4f5-0deddf8d9d7e",
              "name": "=matchCode",
              "value": "={{ $('Loop Over Items').item.json.matchCode }}",
              "type": "string"
            },
            {
              "id": "98952277-b7e1-43b8-a9ed-5711b69ed1ee",
              "name": "=predictionDate",
              "value": "={{ $now.format('yyyy-MM-dd') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1616,
        832
      ],
      "id": "0099bfd0-d429-4dab-a8d5-2c44a97767fb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// è·å–å½“å‰æ—¥æœŸ key\nconst now = new Date();\nconst todayKey = `${now.getFullYear()}_${now.getMonth() + 1}_${now.getDate()}`;\nconst executionFlagKey = `${todayKey}_has_run`;\n\n// è·å–å¹¶æ›´æ–°å…¨å±€é™æ€æ•°æ®\nlet workflowData = $getWorkflowStaticData('global');\nworkflowData[executionFlagKey] = true;\n\nreturn {\n  json: {\n    status: \"success\",\n    message: \"ä»Šæ—¥é¢„æµ‹ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆï¼Œæ‰§è¡Œé”å·²å¼€å¯\",\n    date: todayKey\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        608
      ],
      "id": "f2864279-5784-4393-b78d-de24a787bc08",
      "name": "è®¾ç½®ä»Šæ—¥ä¸Šé”"
    },
    {
      "parameters": {
        "url": "https://api.yucejia.com/api/v1/matchDetail",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "matchId",
              "value": "={{ $('Loop Over Items').item.json.matchId }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "accept-language",
              "value": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"
            },
            {
              "name": "origin",
              "value": "https://www.yucejia.com"
            },
            {
              "name": "priority",
              "value": "u=1, i"
            },
            {
              "name": "referer",
              "value": "https://www.yucejia.com/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Microsoft Edge\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1984,
        800
      ],
      "id": "b792cef9-f00c-4212-9ceb-847ec9b720a7",
      "name": "è·å–æ¯”èµ›è¯¦æƒ…",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä½“è‚²æ•°æ®ç²¾ç®€ä¸“å®¶ã€‚\n\nã€ä»»åŠ¡ã€‘\nè¯·é˜…è¯»è¾“å…¥çš„æ¯”èµ›è¯¦æƒ…åŸå§‹æ•°æ®ï¼Œå°†å…¶è½¬åŒ–ä¸ºä¸€æ®µç®€æ˜ã€é€»è¾‘æ¸…æ™°ä¸”ä¸é—æ¼å…³é”®ä¿¡æ¯çš„â€œæ¯”èµ›å‰ç»æƒ…æŠ¥â€ã€‚\n\nã€å¤„ç†è¦æ±‚ã€‘\n1. ä¼¤åœæƒ…æŠ¥ï¼šé‡ç‚¹åˆ—å‡ºä¸»åŠ›çƒå‘˜çš„ç¼ºé˜µæƒ…å†µåŠå¯¹æ”»é˜²çš„å…·ä½“å½±å“ã€‚\n2. å†å²äº¤é”‹ï¼šæå–è¿‘5æ¬¡å¯¹é˜µçš„èƒœè´Ÿè§„å¾‹åŠè¿›çƒæ•°è¶‹åŠ¿ã€‚\n3. è¿‘æœŸè¡¨ç°ï¼šæ€»ç»“åŒæ–¹æœ€è¿‘3åœºæ¯”èµ›çš„å¾—å¤±çƒç‰¹å¾ï¼ˆå¦‚ï¼šé˜²çº¿ä¸ç¨³ã€è¿›æ”»ä¾¿ç§˜ç­‰ï¼‰ã€‚\n4. æ ¸å¿ƒç»Ÿè®¡ï¼šä»…ä¿ç•™ä¸â€œæ€»è¿›çƒæ•°â€é«˜åº¦ç›¸å…³çš„å…³é”®æŒ‡æ ‡ï¼ˆå¦‚ï¼šå¤§çƒç‡ã€BTTSç‡ï¼‰ã€‚\n\nã€æ•°æ®æºã€‘\n{{ JSON.stringify($('å‡å°‘toke').item.json) }}\n\nã€å¼ºåˆ¶è¾“å‡ºè¦æ±‚ã€‘\n1. ä½¿ç”¨ç®€çŸ­çš„è¦ç‚¹ï¼ˆBullet Pointsï¼‰ã€‚\n2. ä¸è¦åŒ…å«å¼€åœºç™½ã€ç»“æŸè¯­æˆ–ä»»ä½•åˆ†æå»ºè®®ï¼Œåªæä¾›æ•´ç†åçš„äº‹å®æè¿°ã€‚\n3. å¦‚æœæ•°æ®ç¼ºå¤±ï¼Œè¯·ç›´æ¥è¯´æ˜â€œè¯¥é¡¹æ•°æ®ç¼ºå¤±â€ã€‚",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -944,
        800
      ],
      "id": "37251718-feb8-4dfa-9007-4af2493bf398",
      "name": "AI Agent",
      "executeOnce": false,
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "o1-mini-2024-09-12",
          "mode": "list",
          "cachedResultName": "o1-mini-2024-09-12"
        },
        "responsesApiEnabled": false,
        "options": {
          "maxTokens": 30000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -976,
        960
      ],
      "id": "fb05adda-c972-44b2-bc89-dbf5a7978d2e",
      "name": "æ¯”èµ›æ•°æ®é¢„å¤„ç†",
      "credentials": {
        "openAiApi": {
          "id": "h8jtCuruixgdtycY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://www.yucejia.com/matchDetail/matchModel/{{ $('Loop Over Items').item.json.matchId }}.html",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "accept-language",
              "value": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6"
            },
            {
              "name": "origin",
              "value": "https://www.yucejia.com"
            },
            {
              "name": "priority",
              "value": "u=1, i"
            },
            {
              "name": "referer",
              "value": "https://www.yucejia.com/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Microsoft Edge\";v=\"143\", \"Chromium\";v=\"143\", \"Not A(Brand\";v=\"24\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "text",
              "outputPropertyName": "Text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1776,
        800
      ],
      "id": "1939704a-c63d-469d-8ca0-d0fbfafc3a97",
      "name": "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "jsCode": "// ä¿®æ”¹ç‚¹ï¼šä½¿ç”¨ .Text åŒ¹é…ä¸Šæ¸¸èŠ‚ç‚¹è¾“å‡º\nconst html = $input.first().json.Text || \"\"; \nconst output = {\n  external_scores: [],\n  external_goals_desc: \"è¯¥åœºæ¯”èµ›æš‚æ— å¤–éƒ¨æ¨¡å‹æ¯”åˆ†å‚è€ƒã€‚\"\n};\n\n// 1. æå–â€œAIæ¯”åˆ†â€è¡Œä¸­çš„å†…å®¹\nconst tableRowMatch = html.match(/AIæ¯”åˆ†<\\/td>([\\s\\S]*?)<\\/tr>/);\n\nif (tableRowMatch) {\n    const rowHtml = tableRowMatch[1];\n    // åŒ¹é…ç±»ä¼¼ 2-1, 1-0 è¿™ç§æ ¼å¼çš„æ¯”åˆ†\n    const scoreRegex = /(\\d+)-(\\d+)/g;\n    let match;\n    let scoreDetails = [];\n    \n    while ((match = scoreRegex.exec(rowHtml)) !== null) {\n        const home = parseInt(match[1]);\n        const away = parseInt(match[2]);\n        const total = home + away;\n        scoreDetails.push(`${match[0]}(${total}çƒ)`);\n    }\n    \n    if (scoreDetails.length > 0) {\n        output.external_scores = scoreDetails;\n        output.external_goals_desc = `ç¬¬ä¸‰æ–¹AIé¢„æµ‹æ¯”åˆ†ï¼š${scoreDetails.join('ã€')}ã€‚`;\n    }\n}\nif (!html) return { json: { external_goals_desc: \"æ•°æ®æºä¸ºç©º\" } };\nreturn { json: output };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        800
      ],
      "id": "02442827-b6e3-4b07-a6ae-88095141756e",
      "name": "è§£æè¿›çƒæ•°"
    },
    {
      "parameters": {
        "jsCode": "// 1. æ˜¾å¼ä»â€œè·å–æ¯”èµ›è¯¦æƒ…â€èŠ‚ç‚¹è·å–æ•°æ®\n// æ³¨æ„ï¼šn8n çš„ HTTP Request èŠ‚ç‚¹é»˜è®¤å·²å°† body è§£æä¸ºå¯¹è±¡\nconst res = $('è·å–æ¯”èµ›è¯¦æƒ…').item.json.result;\n\nif (!res) {\n  throw new Error(\"æœªèƒ½åœ¨ 'è·å–æ¯”èµ›è¯¦æƒ…' èŠ‚ç‚¹ä¸­æ‰¾åˆ° result æ•°æ®ï¼Œè¯·æ£€æŸ¥ API è¿”å›æ ¼å¼\");\n}\n\n// --- åŠ¨æ€å­—æ®µæå– ---\nconst dynamicLeagueName = res.vsMatches?.matches[0]?.leagueNameFull || \"æœªçŸ¥è”èµ›\"; \n\nconst findTech = (name, side) => {\n  const item = res.techItem?.lastTechStat?.itemList?.find(i => i.name === name);\n  return item ? item[side] : { value: 0, text: \"0\" };\n};\n\n// åŠ¨æ€æå–æ’åå’Œè¿‘å†µ\nconst homePointsAll = res.currentPoints?.homePoints?.points?.find(p => p.pointsKind === \"ALL\");\nconst awayPointsAll = res.currentPoints?.awayPoints?.points?.find(p => p.pointsKind === \"ALL\");\nconst homePointsNear = res.currentPoints?.homePoints?.points?.find(p => p.pointsKind === \"NEAR\");\nconst awayPointsNear = res.currentPoints?.awayPoints?.points?.find(p => p.pointsKind === \"NEAR\");\n\n// 2. æ„é€ å¹¶è¿”å›å¯¹è±¡\nreturn {\n  \"match_info\": {\n    \"league\": dynamicLeagueName,\n    \"season\": res.currentPoints?.homePoints?.curSeason,\n    \"home_team\": res.currentPoints?.homePoints?.teamName,\n    \"away_team\": res.currentPoints?.awayPoints?.teamName,\n    \"referee\": {\n      \"name\": res.analysisItem?.referee?.referee?.name?.cn || \"æœªçŸ¥\",\n      \"avg_yellow_cards\": res.analysisItem?.referee?.avgYellow?.avgNumber || 0\n    }\n  },\n  \"league_standings\": {\n    \"home\": {\n      \"rank\": homePointsAll?.rank,\n      \"points\": homePointsAll?.point,\n      \"recent_form\": homePointsNear ? `${homePointsNear.win}èƒœ${homePointsNear.draw}å¹³${homePointsNear.loss}è´Ÿ` : \"æ— æ•°æ®\",\n      \"goals_avg\": res.analysisItem?.statusCon?.constract?.find(c => c.consType === \"goal\")?.homeAvgAll\n    },\n    \"away\": {\n      \"rank\": awayPointsAll?.rank,\n      \"points\": awayPointsAll?.point,\n      \"recent_form\": awayPointsNear ? `${awayPointsNear.win}èƒœ${awayPointsNear.draw}å¹³${awayPointsNear.loss}è´Ÿ` : \"æ— æ•°æ®\",\n      \"goals_avg\": res.analysisItem?.statusCon?.constract?.find(c => c.consType === \"goal\")?.awayAvgAll\n    }\n  },\n  \"technical_stats_comparison\": {\n    \"metric\": [\"è¿›çƒ\", \"å¤±çƒ\", \"è¢«å°„é—¨\", \"è§’çƒ\", \"æ§çƒç‡\"],\n    \"home\": [\n      findTech(\"è¿›çƒ\", \"home\").value,\n      findTech(\"å¤±çƒ\", \"home\").value,\n      findTech(\"è¢«å°„é—¨\", \"home\").value,\n      findTech(\"è§’çƒ\", \"home\").value,\n      findTech(\"æ§çƒç‡\", \"home\").text\n    ],\n    \"away\": [\n      findTech(\"è¿›çƒ\", \"away\").value,\n      findTech(\"å¤±çƒ\", \"away\").value,\n      findTech(\"è¢«å°„é—¨\", \"away\").value,\n      findTech(\"è§’çƒ\", \"away\").value,\n      findTech(\"æ§çƒç‡\", \"away\").text\n    ]\n  },\n  \"expert_recommendation\": (res.xinShuiRecommend?.recommend?.cn || \"\").split('ã€‚')[0] + \"ã€‚\"\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        800
      ],
      "id": "b1b50364-ea8e-4b33-95a8-4409771a0740",
      "name": "å‡å°‘toke"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "éšæœºèŠ‚ç‚¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "è®¾ç½®ä»Šæ—¥ä¸Šé”",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "claude-opus-4-5-20251101-thinking",
            "type": "main",
            "index": 0
          },
          {
            "node": "gemini-3-pro-preview-thinking",
            "type": "main",
            "index": 0
          },
          {
            "node": "grok-4-fast-reasoning",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "claude-opus-4-5-20251101-thinking",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "claude-opus-4-5-20251101-thinking": {
      "main": [
        [
          {
            "node": "æŠ•æ³¨è€…2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gemini-3-pro-preview-thinking": {
      "main": [
        [
          {
            "node": "æŠ•æ³¨è€…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŠ•æ³¨è€…": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "æŠ•æ³¨è€…",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "grok-4-fast-reasoning",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "æŠ•æ³¨è€…2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "grok-4-fast-reasoning": {
      "main": [
        [
          {
            "node": "æŠ•æ³¨è€…3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "æŠ•æ³¨è€…3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "éšæœºèŠ‚ç‚¹": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŠ•æ³¨è€…2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "æŠ•æ³¨è€…3": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "è·å–æ¯”èµ›è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get AI Memory": {
      "main": [
        [
          {
            "node": "å‡å°‘toke",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Match_Review_Subworkflow_Postgres'": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Call 'Match_Review_Subworkflow_Postgres'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–æ¯”èµ›è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¯”èµ›æ•°æ®é¢„å¤„ç†": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "è·å–å¤–éƒ¨æ¨¡å‹ç½‘é¡µ": {
      "main": [
        [
          {
            "node": "è§£æè¿›çƒæ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æè¿›çƒæ•°": {
      "main": [
        [
          {
            "node": "Get AI Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "gemini-3-pro-preview-thinking",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "å‡å°‘toke": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "timezone": "Asia/Shanghai",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "6ea9d3f3-a4c2-4ec4-b376-0e0c849f8ec1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "1b3592a36faca6d4ee6d59855b7842790b3a656cfb3a4b19bb3a173312c99994"
  },
  "id": "FPwcuHfqza6d2iCm",
  "tags": []
}